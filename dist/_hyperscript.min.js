!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():((e="undefined"!=typeof globalThis?globalThis:e||self)._hyperscript=t(),"document"in e&&e._hyperscript.browserInit(),e._hyperscript)}(this,(function(){"use strict";const e="undefined"!=typeof globalThis?globalThis:self,t={dynamicResolvers:[function(e,t){if("Fixed"===e)return Number(t).toFixed();if(0===e.indexOf("Fixed:")){let r=e.split(":")[1];return Number(t).toFixed(parseInt(r))}}],String:function(e){return e.toString?e.toString():""+e},Int:function(e){return parseInt(e)},Float:function(e){return parseFloat(e)},Number:function(e){return Number(e)},Date:function(e){return new Date(e)},Array:function(e){return Array.from(e)},JSON:function(e){return JSON.stringify(e)},Object:function(e){return e instanceof String&&(e=e.toString()),"string"==typeof e?JSON.parse(e):Object.assign({},e)}},r={attributes:"_, script, data-script",defaultTransition:"all 500ms ease-in",disableSelector:"[disable-scripting], [data-disable-scripting]",hideShowStrategies:{},conversions:t};class n{static OP_TABLE={"+":"PLUS","-":"MINUS","*":"MULTIPLY","/":"DIVIDE",".":"PERIOD","..":"ELLIPSIS","\\":"BACKSLASH",":":"COLON","%":"PERCENT","|":"PIPE","!":"EXCLAMATION","?":"QUESTION","#":"POUND","&":"AMPERSAND",$:"DOLLAR",";":"SEMI",",":"COMMA","(":"L_PAREN",")":"R_PAREN","<":"L_ANG",">":"R_ANG","<=":"LTE_ANG",">=":"GTE_ANG","==":"EQ","===":"EQQ","!=":"NEQ","!==":"NEQQ","{":"L_BRACE","}":"R_BRACE","[":"L_BRACKET","]":"R_BRACKET","=":"EQUALS"};static isValidCSSClassChar(e){return n.isAlpha(e)||n.isNumeric(e)||"-"===e||"_"===e||":"===e}static isValidCSSIDChar(e){return n.isAlpha(e)||n.isNumeric(e)||"-"===e||"_"===e||":"===e}static isWhitespace(e){return" "===e||"\t"===e||n.isNewline(e)}static positionString(e){return"[Line: "+e.line+", Column: "+e.column+"]"}static isNewline(e){return"\r"===e||"\n"===e}static isNumeric(e){return e>="0"&&e<="9"}static isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}static isIdentifierChar(e,t){return"_"===e||"$"===e}static isReservedChar(e){return"`"===e||"^"===e}static isValidSingleQuoteStringStart(e){if(e.length>0){var t=e[e.length-1];if("IDENTIFIER"===t.type||"CLASS_REF"===t.type||"ID_REF"===t.type)return!1;if(t.op&&(">"===t.value||")"===t.value))return!1}return!0}static tokenize(e,t){var r=[],o=e,a=0,s=0,u=1,l="<START>",c=0;function m(){return t&&0===c}for(;a<o.length;)if("-"===q()&&"-"===N()&&(n.isWhitespace(w(2))||""===w(2)||"-"===w(2))||"/"===q()&&"/"===N()&&(n.isWhitespace(w(2))||""===w(2)||"/"===w(2)))f();else if("/"!==q()||"*"!==N()||!n.isWhitespace(w(2))&&""!==w(2)&&"*"!==w(2))if(n.isWhitespace(q()))r.push(R());else if(C()||"."!==q()||!n.isAlpha(N())&&"{"!==N()&&"-"!==N())if(C()||"#"!==q()||!n.isAlpha(N())&&"{"!==N())if("["===q()&&"@"===N())r.push(v());else if("@"===q())r.push(E());else if("*"===q()&&n.isAlpha(N()))r.push(T());else if(n.isAlpha(q())||!m()&&n.isIdentifierChar(q()))r.push(k());else if(n.isNumeric(q()))r.push(x());else if(m()||'"'!==q()&&"`"!==q())if(m()||"'"!==q()){if(q()in n.OP_TABLE)"$"===l&&"{"===q()&&c++,"}"===q()&&c--,r.push(g());else if(m()||n.isReservedChar(q()))r.push(p("RESERVED",I()));else if(a<o.length)throw Error("Unknown token: "+q()+" ")}else n.isValidSingleQuoteStringStart(r)?r.push(b()):r.push(g());else r.push(b());else r.push(y());else r.push(d());else h();return new i(r,[],o);function p(e,t){return{type:e,value:t||"",start:a,end:a+1,column:s,line:u}}function f(){for(;q()&&!n.isNewline(q());)I();I()}function h(){for(;q()&&("*"!==q()||"/"!==N());)I();I(),I()}function d(){var e=p("CLASS_REF"),t=I();if("{"===q()){for(e.template=!0,t+=I();q()&&"}"!==q();)t+=I();if("}"!==q())throw Error("Unterminated class reference");t+=I()}else for(;n.isValidCSSClassChar(q());)t+=I();return e.value=t,e.end=a,e}function v(){for(var e=p("ATTRIBUTE_REF"),t=I();a<o.length&&"]"!==q();)t+=I();return"]"===q()&&(t+=I()),e.value=t,e.end=a,e}function E(){for(var e=p("ATTRIBUTE_REF"),t=I();n.isValidCSSIDChar(q());)t+=I();if("="===q())if(t+=I(),'"'===q()||"'"===q()){t+=b().value}else if(n.isAlpha(q())||n.isNumeric(q())||n.isIdentifierChar(q())){t+=k().value}return e.value=t,e.end=a,e}function T(){for(var e=p("STYLE_REF"),t=I();n.isAlpha(q())||"-"===q();)t+=I();return e.value=t,e.end=a,e}function y(){var e=p("ID_REF"),t=I();if("{"===q()){for(e.template=!0,t+=I();q()&&"}"!==q();)t+=I();if("}"!==q())throw Error("Unterminated id reference");I()}else for(;n.isValidCSSIDChar(q());)t+=I();return e.value=t,e.end=a,e}function k(){for(var e=p("IDENTIFIER"),t=I();n.isAlpha(q())||n.isNumeric(q())||n.isIdentifierChar(q());)t+=I();return"!"===q()&&"beep"===t&&(t+=I()),e.value=t,e.end=a,e}function x(){for(var e=p("NUMBER"),t=I();n.isNumeric(q());)t+=I();for("."===q()&&n.isNumeric(N())&&(t+=I());n.isNumeric(q());)t+=I();for("e"!==q()&&"E"!==q()||(n.isNumeric(N())?t+=I():"-"===N()&&(t+=I(),t+=I()));n.isNumeric(q());)t+=I();return e.value=t,e.end=a,e}function g(){for(var e=function(e,t){var r=p(e,t);return r.op=!0,r}(),t=I();q()&&t+q()in n.OP_TABLE;)t+=I();return e.type=n.OP_TABLE[t],e.value=t,e.end=a,e}function b(){for(var e=p("STRING"),t=I(),r="";q()&&q()!==t;)if("\\"===q()){I();let t=I();if("b"===t)r+="\b";else if("f"===t)r+="\f";else if("n"===t)r+="\n";else if("r"===t)r+="\r";else if("t"===t)r+="\t";else if("v"===t)r+="\v";else if("x"===t){const t=S();if(Number.isNaN(t))throw Error("Invalid hexadecimal escape at "+n.positionString(e));r+=String.fromCharCode(t)}else r+=t}else r+=I();if(q()!==t)throw Error("Unterminated string at "+n.positionString(e));return I(),e.value=r,e.end=a,e.template="`"===t,e}function S(){if(!q())return NaN;let e=16*Number.parseInt(I(),16);return q()?(e+=Number.parseInt(I(),16),e):NaN}function q(){return o.charAt(a)}function N(){return o.charAt(a+1)}function w(e=1){return o.charAt(a+e)}function I(){return l=q(),a++,s++,l}function C(){return n.isAlpha(l)||n.isNumeric(l)||")"===l||'"'===l||"'"===l||"`"===l||"}"===l||"]"===l}function R(){for(var e=p("WHITESPACE"),t="";q()&&n.isWhitespace(q());)n.isNewline(q())&&(s=0,u++),t+=I();return e.value=t,e.end=a,e}}tokenize(e,t){return n.tokenize(e,t)}}class i{constructor(e,t,r){this.tokens=e,this.consumed=t,this.source=r,this.consumeWhitespace()}get list(){return this.tokens}_lastConsumed=void 0;consumeWhitespace(){for(;"WHITESPACE"===this.token(0,!0).type;){void 0!==this.tokens.shift()&&this.consumed.push()}}raiseError(e,t){o.raiseParseError(e,t)}requireOpToken(e){var t=this.matchOpToken(e);if(t)return t;this.raiseError(this,"Expected '"+e+"' but found '"+this.currentToken().value+"'")}matchAnyOpToken(e,t,r){for(var n=0;n<arguments.length;n++){var i=arguments[n],o=this.matchOpToken(i);if(o)return o}}matchAnyToken(e){for(var t=0;t<arguments.length;t++){var r=arguments[t],n=this.matchToken(r);if(void 0!==n)return n}}matchOpToken(e){if(this.currentToken()&&this.currentToken().op&&this.currentToken().value===e)return this.consumeToken()}requireTokenType(e,t,r,n){var i=this.matchTokenType(e,t,r,n);if(i)return i;this.raiseError(this,"Expected one of "+JSON.stringify([e,t,r]))}matchTokenType(e,t,r,n){if(this.currentToken()&&this.currentToken().type&&[e,t,r,n].indexOf(this.currentToken().type)>=0)return this.consumeToken()}requireToken(e,t){var r=this.matchToken(e,t);if(r)return r;this.raiseError(this,"Expected '"+e+"' but found '"+this.currentToken().value+"'")}peekToken(e,t,r){if(t=t||0,r=r||"IDENTIFIER",this.tokens[t]&&this.tokens[t].value===e&&this.tokens[t].type===r)return this.tokens[t]}matchToken(e,t){if(-1===this.follows.indexOf(e))return t=t||"IDENTIFIER",this.currentToken()&&this.currentToken().value===e&&this.currentToken().type===t?this.consumeToken():void 0}consumeToken(){var e=this.tokens.shift();return void 0!==e&&(this.consumed.push(e),this._lastConsumed=e),this.consumeWhitespace(),void 0!==e?e:{type:"EOF",value:"<<<EOF>>>"}}consumeUntil(e,t){for(var r=[],n=this.token(0,!0);!(null!=t&&n.type===t||null!=e&&n.value===e||"EOF"===n.type);){var i=this.tokens.shift();void 0!==i&&this.consumed.push(i),r.push(n),n=this.token(0,!0)}return this.consumeWhitespace(),r}lastWhitespace(){return this.consumed[this.consumed.length-1]&&"WHITESPACE"===this.consumed[this.consumed.length-1].type?this.consumed[this.consumed.length-1].value:""}consumeUntilWhitespace(){return this.consumeUntil(null,"WHITESPACE")}hasMore(){return this.tokens.length>0}token(e,t){var r,n=0;do{if(!t)for(;this.tokens[n]&&"WHITESPACE"===this.tokens[n].type;)n++;r=this.tokens[n],e--,n++}while(e>-1);return r||{type:"EOF",value:"<<<EOF>>>"}}currentToken(){return this.token(0)}lastMatch(){return this._lastConsumed}static sourceFor=function(){var e=this.programSource,t=this.endToken;return e.substring(this.startToken.start||0,void 0!==t&&t.end||e.length)};static lineFor=function(){return this.programSource.split("\n")[this.startToken.line-1]};follows=[];pushFollow(e){this.follows.push(e)}popFollow(){this.follows.pop()}clearFollows(){var e=this.follows;return this.follows=[],e}restoreFollows(e){this.follows=e}}class o{constructor(e){this.runtime=e,this.possessivesDisabled=!1,this.addGrammarElement("feature",(function(e,t,r){if(r.matchOpToken("(")){var n=e.requireElement("feature",r);return r.requireOpToken(")"),n}var i=e.FEATURES[r.currentToken().value||""];if(i)return i(e,t,r)})),this.addGrammarElement("command",(function(e,t,r){if(r.matchOpToken("(")){const t=e.requireElement("command",r);return r.requireOpToken(")"),t}var n=e.COMMANDS[r.currentToken().value||""];let i;return n?i=n(e,t,r):"IDENTIFIER"===r.currentToken().type&&(i=e.parseElement("pseudoCommand",r)),i?e.parseElement("indirectStatement",r,i):i})),this.addGrammarElement("commandList",(function(e,t,r){if(r.hasMore()){var n=e.parseElement("command",r);if(n){r.matchToken("then");const t=e.parseElement("commandList",r);return t&&(n.next=t),n}}return{type:"emptyCommandListCommand",op:function(e){return t.findNext(this,e)},execute:function(e){return t.unifiedExec(this,e)}}})),this.addGrammarElement("leaf",(function(e,t,r){var n=e.parseAnyOf(e.LEAF_EXPRESSIONS,r);return null==n?e.parseElement("symbol",r):n})),this.addGrammarElement("indirectExpression",(function(e,t,r,n){for(var i=0;i<e.INDIRECT_EXPRESSIONS.length;i++){var o=e.INDIRECT_EXPRESSIONS[i];n.endToken=r.lastMatch();var a=e.parseElement(o,r,n);if(a)return a}return n})),this.addGrammarElement("indirectStatement",(function(e,t,r,n){if(r.matchToken("unless")){n.endToken=r.lastMatch();var i={type:"unlessStatementModifier",args:[e.requireElement("expression",r)],op:function(e,t){return t?this.next:n},execute:function(e){return t.unifiedExec(this,e)}};return n.parent=i,i}return n})),this.addGrammarElement("primaryExpression",(function(e,t,r){var n=e.parseElement("leaf",r);if(n)return e.parseElement("indirectExpression",r,n);e.raiseParseError(r,"Unexpected value: "+r.currentToken().value)}))}use(e){return e(this),this}GRAMMAR={};COMMANDS={};FEATURES={};LEAF_EXPRESSIONS=[];INDIRECT_EXPRESSIONS=[];initElt(e,t,r){e.startToken=t,e.sourceFor=i.sourceFor,e.lineFor=i.lineFor,e.programSource=r.source}parseElement(e,t,r=void 0){var n=this.GRAMMAR[e];if(void 0!==n){var i=t.currentToken(),o=n(this,this.runtime,t,r);if(void 0!==o){this.initElt(o,i,t),o.endToken=o.endToken||t.lastMatch();for(r=o.root;null!=r;)this.initElt(r,i,t),r=r.root}return o}}requireElement(e,t,r,n){var i=this.parseElement(e,t,n);return i||o.raiseParseError(t,r||"Expected "+e),i}parseAnyOf(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=this.parseElement(n,t);if(i)return i}}addGrammarElement(e,t){this.GRAMMAR[e]=t}addCommand(e,t){var r=e+"Command",n=function(e,n,i){const o=t(e,n,i);if(o)return o.type=r,o.execute=function(e){return e.meta.command=o,n.unifiedExec(this,e)},o};this.GRAMMAR[r]=n,this.COMMANDS[e]=n}addFeature(e,t){var r=e+"Feature",n=function(n,i,o){var a=t(n,i,o);if(void 0!==a)return a.isFeature=!0,a.keyword=e,a.type=r,a};this.GRAMMAR[r]=n,this.FEATURES[e]=n}addLeafExpression(e,t){this.LEAF_EXPRESSIONS.push(e),this.addGrammarElement(e,t)}addIndirectExpression(e,t){this.INDIRECT_EXPRESSIONS.push(e),this.addGrammarElement(e,t)}static createParserContext(e){var t=e.currentToken(),r=e.source.split("\n"),n=r[t&&t.line?t.line-1:r.length-1],i=t&&t.line?t.column:n.length-1;return n+"\n"+" ".repeat(i)+"^^\n\n"}static raiseParseError(e,t){t=(t||"Unexpected Token : "+e.currentToken().value)+"\n\n"+o.createParserContext(e);var r=new Error(t);throw r.tokens=e,r}raiseParseError(e,t){o.raiseParseError(e,t)}parseHyperScript(e){var t=this.parseElement("hyperscript",e);if(e.hasMore()&&this.raiseParseError(e),t)return t}setParent(e,t){"object"==typeof e&&(e.parent=t,"object"==typeof t&&(t.children=t.children||new Set,t.children.add(e)),this.setParent(e.next,t))}commandStart(e){return this.COMMANDS[e.value||""]}featureStart(e){return this.FEATURES[e.value||""]}commandBoundary(e){return!("end"!=e.value&&"then"!=e.value&&"else"!=e.value&&"otherwise"!=e.value&&")"!=e.value&&!this.commandStart(e)&&!this.featureStart(e)&&"EOF"!=e.type)}parseStringTemplate(e){var t=[""];do{if(t.push(e.lastWhitespace()),"$"===e.currentToken().value){e.consumeToken();var r=e.matchOpToken("{");t.push(this.requireElement("expression",e)),r&&e.requireOpToken("}"),t.push("")}else if("\\"===e.currentToken().value)e.consumeToken(),e.consumeToken();else{var n=e.consumeToken();t[t.length-1]+=n?n.value:""}}while(e.hasMore());return t.push(e.lastWhitespace()),t}ensureTerminated(e){const t=this.runtime;for(var r={type:"implicitReturn",op:function(e){return e.meta.returned=!0,e.meta.resolve&&e.meta.resolve(),t.HALT},execute:function(e){}},n=e;n.next;)n=n.next;n.next=r}}class a{constructor(e,t){this.lexer=e??new n,this.parser=t??new o(this).use(E).use(T),this.parser.runtime=this}matchesSelector(e,t){var r=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return r&&r.call(e,t)}makeEvent(t,r){var n;return e.Event&&"function"==typeof e.Event?(n=new Event(t,{bubbles:!0,cancelable:!0})).detail=r:(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,r),n}triggerEvent(e,t,r,n){(r=r||{}).sender=n;var i=this.makeEvent(t,r);return e.dispatchEvent(i)}isArrayLike(e){return Array.isArray(e)||"undefined"!=typeof NodeList&&(e instanceof NodeList||e instanceof HTMLCollection)}isIterable(e){return"object"==typeof e&&Symbol.iterator in e&&"function"==typeof e[Symbol.iterator]}shouldAutoIterate(e){return null!=e&&e[f]||this.isArrayLike(e)}forEach(e,t){if(null==e);else if(this.isIterable(e))for(const r of e)t(r);else if(this.isArrayLike(e))for(var r=0;r<e.length;r++)t(e[r]);else t(e)}implicitLoop(e,t){if(this.shouldAutoIterate(e))for(const r of e)t(r);else t(e)}wrapArrays(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];Array.isArray(n)?t.push(Promise.all(n)):t.push(n)}return t}unwrapAsyncs(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.asyncWrapper&&(e[t]=r.value),Array.isArray(r))for(var n=0;n<r.length;n++){var i=r[n];i.asyncWrapper&&(r[n]=i.value)}}}static HALT={};HALT=a.HALT;unifiedExec(e,t){for(;;){try{var r=this.unifiedEval(e,t)}catch(n){if(t.meta.handlingFinally)console.error(" Exception in finally block: ",n),r=a.HALT;else{if(this.registerHyperTrace(t,n),t.meta.errorHandler&&!t.meta.handlingError){t.meta.handlingError=!0,t.locals[t.meta.errorSymbol]=n,e=t.meta.errorHandler;continue}t.meta.currentException=n,r=a.HALT}}if(null==r)return void console.error(e," did not return a next element to execute! context: ",t);if(r.then)return void r.then((e=>{this.unifiedExec(e,t)})).catch((e=>{this.unifiedExec({op:function(){throw e}},t)}));if(r===a.HALT){if(!t.meta.finallyHandler||t.meta.handlingFinally){if(t.meta.onHalt&&t.meta.onHalt(),t.meta.currentException){if(t.meta.reject)return void t.meta.reject(t.meta.currentException);throw t.meta.currentException}return}t.meta.handlingFinally=!0,e=t.meta.finallyHandler}else e=r}}unifiedEval(e,t){var r=[t],n=!1,i=!1;if(e.args)for(var o=0;o<e.args.length;o++){var a=e.args[o];if(null==a)r.push(null);else if(Array.isArray(a)){for(var s=[],u=0;u<a.length;u++){var l=a[u];(c=l?l.evaluate(t):null)&&(c.then?n=!0:c.asyncWrapper&&(i=!0)),s.push(c)}r.push(s)}else if(a.evaluate){var c;(c=a.evaluate(t))&&(c.then?n=!0:c.asyncWrapper&&(i=!0)),r.push(c)}else r.push(a)}return n?new Promise(((t,n)=>{r=this.wrapArrays(r),Promise.all(r).then((r=>{i&&this.unwrapAsyncs(r);try{var o=e.op.apply(e,r);t(o)}catch(e){n(e)}})).catch((e=>{n(e)}))})):(i&&this.unwrapAsyncs(r),e.op.apply(e,r))}_scriptAttrs=null;getScriptAttributes(){return null==this._scriptAttrs&&(this._scriptAttrs=r.attributes.replace(/ /g,"").split(",")),this._scriptAttrs}getScript(e){for(var t=0;t<this.getScriptAttributes().length;t++){var r=this.getScriptAttributes()[t];if(e.hasAttribute&&e.hasAttribute(r))return e.getAttribute(r)}return e instanceof HTMLScriptElement&&"text/hyperscript"===e.type?e.innerText:null}hyperscriptFeaturesMap=new WeakMap;getHyperscriptFeatures(e){var t=this.hyperscriptFeaturesMap.get(e);return void 0===t&&e&&this.hyperscriptFeaturesMap.set(e,t={}),t}addFeatures(e,t){e&&(Object.assign(t.locals,this.getHyperscriptFeatures(e)),this.addFeatures(e.parentElement,t))}makeContext(e,t,r,n){return new m(e,t,r,n,this)}getScriptSelector(){return this.getScriptAttributes().map((function(e){return"["+e+"]"})).join(", ")}convertValue(e,r){for(var n=t.dynamicResolvers,i=0;i<n.length;i++){var o=(0,n[i])(r,e);if(void 0!==o)return o}if(null==e)return null;var a=t[r];if(a)return a(e);throw"Unknown conversion : "+r}parse(e){const t=this.lexer,r=this.parser;var n=t.tokenize(e);if(this.parser.commandStart(n.currentToken())){var i=r.requireElement("commandList",n);return n.hasMore()&&r.raiseParseError(n),r.ensureTerminated(i),i}if(r.featureStart(n.currentToken())){var o=r.requireElement("hyperscript",n);return n.hasMore()&&r.raiseParseError(n),o}var a=r.requireElement("expression",n);return n.hasMore()&&r.raiseParseError(n),a}evaluateNoPromise(e,t){let r=e.evaluate(t);if(r.next)throw new Error(i.sourceFor.call(e)+" returned a Promise in a context that they are not allowed.");return r}evaluate(t,r,n){class i extends EventTarget{constructor(e){super(),this.module=e}toString(){return this.module.id}}var o="document"in e?e.document.body:new i(n&&n.module),a=Object.assign(this.makeContext(o,null,o,null),r||{}),s=this.parse(t);return s.execute?(s.execute(a),void 0!==a.meta.returnValue?a.meta.returnValue:a.result):s.apply?(s.apply(o,o,n),this.getHyperscriptFeatures(o)):s.evaluate(a)}processNode(e){var t=this.getScriptSelector();e instanceof Element&&this.matchesSelector(e,t)&&this.initElement(e,e),e instanceof HTMLScriptElement&&"text/hyperscript"===e.type&&this.initElement(e,document.body),e.querySelectorAll&&this.forEach(e.querySelectorAll(t+", [type='text/hyperscript']"),(e=>{this.initElement(e,e instanceof HTMLScriptElement&&"text/hyperscript"===e.type?document.body:e)}))}initElement(e,t){if(!e.closest||!e.closest(r.disableSelector)){var n=this.getInternalData(e);if(!n.initialized){var i=this.getScript(e);if(i)try{n.initialized=!0,n.script=i;const r=this.lexer,s=this.parser;var o=r.tokenize(i),a=s.parseHyperScript(o);if(!a)return;a.apply(t||e,e),setTimeout((()=>{this.triggerEvent(t||e,"load",{hyperscript:!0})}),1)}catch(t){this.triggerEvent(e,"exception",{error:t}),console.error("hyperscript errors were found on the following element:",e,"\n\n",t)}}}}internalDataMap=new WeakMap;getInternalData(e){var t=this.internalDataMap.get(e);return void 0===t&&this.internalDataMap.set(e,t={}),t}typeCheck(e,t,r){return!(null!=e||!r)||Object.prototype.toString.call(e).slice(8,-1)===t}getElementScope(e){var t=e.meta&&e.meta.owner;if(t){var r=this.getInternalData(t),n="elementScope";return e.meta.feature&&e.meta.feature.behavior&&(n=e.meta.feature.behavior+"Scope"),h(r,n)}return{}}isReservedWord(e){return"meta"===e||"it"===e||"result"===e||"locals"===e||"event"===e||"target"===e||"detail"===e||"sender"===e||"body"===e}isHyperscriptContext(e){return e instanceof m}resolveSymbol(t,r,n){if("me"===t||"my"===t||"I"===t)return r.me;if("it"===t||"its"===t||"result"===t)return r.result;if("you"===t||"your"===t||"yourself"===t)return r.you;if("global"===n)return e[t];if("element"===n)return this.getElementScope(r)[t];if("local"===n)return r.locals[t];if(r.meta&&r.meta.context){var i=r.meta.context[t];if(void 0!==i)return i;if(r.meta.context.detail&&void 0!==(i=r.meta.context.detail[t]))return i}if(this.isHyperscriptContext(r)&&!this.isReservedWord(t))var o=r.locals[t];else o=r[t];return void 0!==o||void 0!==(o=this.getElementScope(r)[t])?o:e[t]}setSymbol(t,r,n,i){if("global"===n)e[t]=i;else if("element"===n){(o=this.getElementScope(r))[t]=i}else if("local"===n)r.locals[t]=i;else{var o;if(this.isHyperscriptContext(r)&&!this.isReservedWord(t)&&void 0!==r.locals[t])r.locals[t]=i;else void 0!==(o=this.getElementScope(r))[t]?o[t]=i:this.isHyperscriptContext(r)&&!this.isReservedWord(t)?r.locals[t]=i:r[t]=i}}findNext(e,t){if(e)return e.resolveNext?e.resolveNext(t):e.next?e.next:this.findNext(e.parent,t)}flatGet(e,t,r){if(null!=e){var n=r(e,t);if(void 0!==n)return n;if(this.shouldAutoIterate(e)){var i=[];for(var o of e){var a=r(o,t);i.push(a)}return i}}}resolveProperty(e,t){return this.flatGet(e,t,((e,t)=>e[t]))}resolveAttribute(e,t){return this.flatGet(e,t,((e,t)=>e.getAttribute&&e.getAttribute(t)))}resolveStyle(e,t){return this.flatGet(e,t,((e,t)=>e.style&&e.style[t]))}resolveComputedStyle(e,t){return this.flatGet(e,t,((e,t)=>getComputedStyle(e).getPropertyValue(t)))}assignToNamespace(t,r,n,i){let o;var a;for(o="undefined"!=typeof document&&t===document.body?e:this.getHyperscriptFeatures(t);void 0!==(a=r.shift());){var s=o[a];null==s&&(s={},o[a]=s),o=s}o[n]=i}getHyperTrace(e,t){for(var r=e;r.meta.caller;)r=r.meta.caller;if(r.meta.traceMap)return r.meta.traceMap.get(t,[])}registerHyperTrace(e,t){for(var r=[],n=null;null!=e;)r.push(e),n=e,e=e.meta.caller;if(null==n.meta.traceMap&&(n.meta.traceMap=new Map),!n.meta.traceMap.get(t)){var i={trace:r,print:function(e){(e=e||console.error)("hypertrace /// ");for(var t=0,n=0;n<r.length;n++)t=Math.max(t,r[n].meta.feature.displayName.length);for(n=0;n<r.length;n++){var i=r[n];e("  ->",i.meta.feature.displayName.padEnd(t+2),"-",i.meta.owner)}}};n.meta.traceMap.set(t,i)}}escapeSelector(e){return e.replace(/:/g,(function(e){return"\\"+e}))}nullCheck(e,t){if(null==e)throw new Error("'"+t.sourceFor()+"' is null")}isEmpty(e){return null==e||0===e.length}doesExist(e){if(null==e)return!1;if(this.shouldAutoIterate(e)){for(const t of e)return!0;return!1}return!0}getRootNode(e){if(e&&e instanceof Node){var t=e.getRootNode();if(t instanceof Document||t instanceof ShadowRoot)return t}return document}getEventQueueFor(e,t){let r=this.getInternalData(e);var n=r.eventQueues;null==n&&(n=new Map,r.eventQueues=n);var i=n.get(t);return null==i&&(i={queue:[],executing:!1},n.set(t,i)),i}beepValueToConsole(e,t,r){if(this.triggerEvent(e,"hyperscript:beep",{element:e,expression:t,value:r})){var n,o=r;"String"===(n=r?r instanceof p?"ElementCollection":r.constructor?r.constructor.name:"unknown":"object (null)")?o='"'+o+'"':r instanceof p&&(o=Array.from(r)),console.log("///_ BEEP! The expression ("+i.sourceFor.call(t).replace("beep! ","")+") evaluates to:",o,"of type "+n)}}hyperscriptUrl="document"in e&&document.currentScript?document.currentScript.src:null}function s(){return document.cookie.split("; ").map((e=>{let t=e.split("=");return{name:t[0],value:decodeURIComponent(t[1])}}))}function u(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}function l(){for(const e of s())u(e.name)}const c=new Proxy({},{get(e,t){if("symbol"==typeof t)return t===Symbol.iterator?s()[t]:void 0;if("then"===t||"asyncWrapper"===t)return null;if("length"===t)return s().length;if("clear"===t)return u;if("clearAll"===t)return l;if(!isNaN(Number(t)))return s()[parseInt(t)];{let e=document.cookie.split("; ").find((e=>e.startsWith(t+"=")))?.split("=")[1];if(e)return decodeURIComponent(e)}},set(e,t,r){if("symbol"==typeof t)return!1;var n=null;return"string"==typeof r?(n=encodeURIComponent(r),n+=";samesite=lax"):(n=encodeURIComponent(r.value),r.expires&&(n+=";expires="+r.maxAge),r.maxAge&&(n+=";max-age="+r.maxAge),r.partitioned&&(n+=";partitioned="+r.partitioned),r.path&&(n+=";path="+r.path),r.samesite&&(n+=";samesite="+r.path),r.secure&&(n+=";secure="+r.path)),document.cookie=t+"="+n,!0}});class m{constructor(t,r,n,i,o){this.meta={parser:o.parser,lexer:o.lexer,runtime:o,owner:t,feature:r,iterators:{},ctx:this},this.locals={cookies:c},this.me=n,this.you=void 0,this.result=void 0,this.event=i,this.target=i?i.target:null,this.detail=i?i.detail:null,this.sender=i&&i.detail?i.detail.sender:null,this.body="document"in e?document.body:null,o.addFeatures(t,this)}}class p{constructor(e,t,r){this._css=e,this.relativeToElement=t,this.escape=r,this[f]=!0}get css(){return this.escape?a.prototype.escapeSelector(this._css):this._css}get className(){return this._css.substr(1)}get id(){return this.className()}contains(e){for(let t of this)if(t.contains(e))return!0;return!1}get length(){return this.selectMatches().length}[Symbol.iterator](){return this.selectMatches()[Symbol.iterator]()}selectMatches(){return a.prototype.getRootNode(this.relativeToElement).querySelectorAll(this.css)}}const f=Symbol();function h(e,t){var r=e[t];if(r)return r;var n={};return e[t]=n,n}function d(e){try{return JSON.parse(e)}catch(e){return t=e,console.error?console.error(t):console.log&&console.log("ERROR: ",t),null}var t}function v(e,t){return new(e.bind.apply(e,[e].concat(t)))}function E(t){t.addLeafExpression("parenthesized",(function(e,t,r){if(r.matchOpToken("(")){var n=r.clearFollows();try{var i=e.requireElement("expression",r)}finally{r.restoreFollows(n)}return r.requireOpToken(")"),i}})),t.addLeafExpression("string",(function(e,t,r){var i=r.matchTokenType("STRING");if(i){var o,a=i.value;if(i.template){var s=n.tokenize(a,!0);o=e.parseStringTemplate(s)}else o=[];return{type:"string",token:i,args:o,op:function(e){for(var t="",r=1;r<arguments.length;r++){var n=arguments[r];void 0!==n&&(t+=n)}return t},evaluate:function(e){return 0===o.length?a:t.unifiedEval(this,e)}}}})),t.addGrammarElement("nakedString",(function(e,t,r){if(r.hasMore()){var n=r.consumeUntilWhitespace();return r.matchTokenType("WHITESPACE"),{type:"nakedString",tokens:n,evaluate:function(e){return n.map((function(e){return e.value})).join("")}}}})),t.addLeafExpression("number",(function(e,t,r){var n=r.matchTokenType("NUMBER");if(n){var i=n,o=parseFloat(n.value);return{type:"number",value:o,numberToken:i,evaluate:function(){return o}}}})),t.addLeafExpression("idRef",(function(e,t,r){var i=r.matchTokenType("ID_REF");if(i&&i.value){if(i.template){var o=i.value.substring(2),a=n.tokenize(o);return{type:"idRefTemplate",args:[e.requireElement("expression",a)],op:function(e,r){return t.getRootNode(e.me).getElementById(r)},evaluate:function(e){return t.unifiedEval(this,e)}}}{const e=i.value.substring(1);return{type:"idRef",css:i.value,value:e,evaluate:function(r){return t.getRootNode(r.me).getElementById(e)}}}}})),t.addLeafExpression("classRef",(function(e,t,r){var i=r.matchTokenType("CLASS_REF");if(i&&i.value){if(i.template){var o=i.value.substring(2),a=n.tokenize(o);return{type:"classRefTemplate",args:[e.requireElement("expression",a)],op:function(e,t){return new p("."+t,e.me,!0)},evaluate:function(e){return t.unifiedEval(this,e)}}}{const e=i.value;return{type:"classRef",css:e,evaluate:function(t){return new p(e,t.me,!0)}}}}}));class r extends p{constructor(e,t,r){super(e,t),this.templateParts=r,this.elements=r.filter((e=>e instanceof Element))}get css(){let e="",t=0;for(const r of this.templateParts)r instanceof Element?e+="[data-hs-query-id='"+t+++"']":e+=r;return e}[Symbol.iterator](){this.elements.forEach(((e,t)=>e.dataset.hsQueryId=t));const e=super[Symbol.iterator]();return this.elements.forEach((e=>e.removeAttribute("data-hs-query-id"))),e}}t.addLeafExpression("queryRef",(function(e,t,i){if(i.matchOpToken("<")){var o=i.consumeUntil("/");i.requireOpToken("/"),i.requireOpToken(">");var a,s,u,l=o.map((function(e){return"STRING"===e.type?'"'+e.value+'"':e.value})).join("");return l.indexOf("$")>=0&&(a=!0,s=n.tokenize(l,!0),u=e.parseStringTemplate(s)),{type:"queryRef",css:l,args:u,op:function(e,...t){return a?new r(l,e.me,t):new p(l,e.me)},evaluate:function(e){return t.unifiedEval(this,e)}}}})),t.addLeafExpression("attributeRef",(function(e,t,r){var n=r.matchTokenType("ATTRIBUTE_REF");if(n&&n.value){var i=n.value;if(0===i.indexOf("["))var o=i.substring(2,i.length-1);else o=i.substring(1);var a="["+o+"]",s=o.split("="),u=s[0],l=s[1];return l&&0===l.indexOf('"')&&(l=l.substring(1,l.length-1)),{type:"attributeRef",name:u,css:a,value:l,op:function(e){var t=e.you||e.me;if(t)return t.getAttribute(u)},evaluate:function(e){return t.unifiedEval(this,e)}}}})),t.addLeafExpression("styleRef",(function(e,t,r){var n=r.matchTokenType("STYLE_REF");if(n&&n.value){var i=n.value.substr(1);return i.startsWith("computed-")?{type:"computedStyleRef",name:i=i.substr(9),op:function(e){var r=e.you||e.me;if(r)return t.resolveComputedStyle(r,i)},evaluate:function(e){return t.unifiedEval(this,e)}}:{type:"styleRef",name:i,op:function(e){var r=e.you||e.me;if(r)return t.resolveStyle(r,i)},evaluate:function(e){return t.unifiedEval(this,e)}}}})),t.addGrammarElement("objectKey",(function(e,t,r){var n;if(n=r.matchTokenType("STRING"))return{type:"objectKey",key:n.value,evaluate:function(){return n.value}};if(r.matchOpToken("[")){var i=e.parseElement("expression",r);return r.requireOpToken("]"),{type:"objectKey",expr:i,args:[i],op:function(e,t){return t},evaluate:function(e){return t.unifiedEval(this,e)}}}var o="";do{(n=r.matchTokenType("IDENTIFIER")||r.matchOpToken("-"))&&(o+=n.value)}while(n);return{type:"objectKey",key:o,evaluate:function(){return o}}})),t.addLeafExpression("objectLiteral",(function(e,t,r){if(r.matchOpToken("{")){var n=[],i=[];if(!r.matchOpToken("}")){do{var o=e.requireElement("objectKey",r);r.requireOpToken(":");var a=e.requireElement("expression",r);i.push(a),n.push(o)}while(r.matchOpToken(","));r.requireOpToken("}")}return{type:"objectLiteral",args:[n,i],op:function(e,t,r){for(var n={},i=0;i<t.length;i++)n[t[i]]=r[i];return n},evaluate:function(e){return t.unifiedEval(this,e)}}}})),t.addGrammarElement("nakedNamedArgumentList",(function(e,t,r){var n=[],i=[];if("IDENTIFIER"===r.currentToken().type)do{var o=r.requireTokenType("IDENTIFIER");r.requireOpToken(":");var a=e.requireElement("expression",r);i.push(a),n.push({name:o,value:a})}while(r.matchOpToken(","));return{type:"namedArgumentList",fields:n,args:[i],op:function(e,t){for(var r={_namedArgList_:!0},i=0;i<t.length;i++){r[n[i].name.value]=t[i]}return r},evaluate:function(e){return t.unifiedEval(this,e)}}})),t.addGrammarElement("namedArgumentList",(function(e,t,r){if(r.matchOpToken("(")){var n=e.requireElement("nakedNamedArgumentList",r);return r.requireOpToken(")"),n}})),t.addGrammarElement("symbol",(function(e,t,r){var n="default";r.matchToken("global")?n="global":r.matchToken("element")||r.matchToken("module")?(n="element",r.matchOpToken("'")&&r.requireToken("s")):r.matchToken("local")&&(n="local");let i=r.matchOpToken(":"),o=r.matchTokenType("IDENTIFIER");if(o&&o.value){var a=o.value;return i&&(a=":"+a),"default"===n&&(0===a.indexOf("$")&&(n="global"),0===a.indexOf(":")&&(n="element")),{type:"symbol",token:o,scope:n,name:a,evaluate:function(e){return t.resolveSymbol(a,e,n)}}}})),t.addGrammarElement("implicitMeTarget",(function(e,t,r){return{type:"implicitMeTarget",evaluate:function(e){return e.you||e.me}}})),t.addLeafExpression("boolean",(function(e,t,r){var n=r.matchToken("true")||r.matchToken("false");if(!n)return;const i="true"===n.value;return{type:"boolean",evaluate:function(e){return i}}})),t.addLeafExpression("null",(function(e,t,r){if(r.matchToken("null"))return{type:"null",evaluate:function(e){return null}}})),t.addLeafExpression("arrayLiteral",(function(e,t,r){if(r.matchOpToken("[")){var n=[];if(!r.matchOpToken("]")){do{var i=e.requireElement("expression",r);n.push(i)}while(r.matchOpToken(","));r.requireOpToken("]")}return{type:"arrayLiteral",values:n,args:[n],op:function(e,t){return t},evaluate:function(e){return t.unifiedEval(this,e)}}}})),t.addLeafExpression("blockLiteral",(function(e,t,r){if(r.matchOpToken("\\")){var n=[],i=r.matchTokenType("IDENTIFIER");if(i)for(n.push(i);r.matchOpToken(",");)n.push(r.requireTokenType("IDENTIFIER"));r.requireOpToken("-"),r.requireOpToken(">");var o=e.requireElement("expression",r);return{type:"blockLiteral",args:n,expr:o,evaluate:function(e){return function(){for(var t=0;t<n.length;t++)e.locals[n[t].value]=arguments[t];return o.evaluate(e)}}}}})),t.addIndirectExpression("propertyAccess",(function(e,t,r,n){if(r.matchOpToken(".")){var i=r.requireTokenType("IDENTIFIER"),o={type:"propertyAccess",root:n,prop:i,args:[n],op:function(e,r){return t.resolveProperty(r,i.value)},evaluate:function(e){return t.unifiedEval(this,e)}};return e.parseElement("indirectExpression",r,o)}})),t.addIndirectExpression("of",(function(e,t,r,n){if(r.matchToken("of")){for(var i=e.requireElement("unaryExpression",r),o=null,a=n;a.root;)o=a,a=a.root;"symbol"!==a.type&&"attributeRef"!==a.type&&"styleRef"!==a.type&&"computedStyleRef"!==a.type&&e.raiseParseError(r,"Cannot take a property of a non-symbol: "+a.type);var s="attributeRef"===a.type,u="styleRef"===a.type||"computedStyleRef"===a.type;if(s||u)var l=a;var c=a.name,m={type:"ofExpression",prop:a.token,root:i,attribute:l,expression:n,args:[i],op:function(e,r){return s?t.resolveAttribute(r,c):u?"computedStyleRef"===a.type?t.resolveComputedStyle(r,c):t.resolveStyle(r,c):t.resolveProperty(r,c)},evaluate:function(e){return t.unifiedEval(this,e)}};return"attributeRef"===a.type&&(m.attribute=a),o?(o.root=m,o.args=[m]):n=m,e.parseElement("indirectExpression",r,n)}})),t.addIndirectExpression("possessive",(function(e,t,r,n){if(!e.possessivesDisabled){var i=r.matchOpToken("'");if(i||"symbol"===n.type&&("my"===n.name||"its"===n.name||"your"===n.name)&&("IDENTIFIER"===r.currentToken().type||"ATTRIBUTE_REF"===r.currentToken().type||"STYLE_REF"===r.currentToken().type)){var o,a,s;i&&r.requireToken("s"),null==(o=e.parseElement("attributeRef",r))&&null==(a=e.parseElement("styleRef",r))&&(s=r.requireTokenType("IDENTIFIER"));var u={type:"possessive",root:n,attribute:o||a,prop:s,args:[n],op:function(e,r){if(o)var n=t.resolveAttribute(r,o.name);else if(a){n="computedStyleRef"===a.type?t.resolveComputedStyle(r,a.name):t.resolveStyle(r,a.name)}else n=t.resolveProperty(r,s.value);return n},evaluate:function(e){return t.unifiedEval(this,e)}};return e.parseElement("indirectExpression",r,u)}}})),t.addIndirectExpression("inExpression",(function(e,t,r,n){if(r.matchToken("in")){var i={type:"inExpression",root:n,args:[n,e.requireElement("unaryExpression",r)],op:function(e,r,n){var i=[];if(r.css)t.implicitLoop(n,(function(e){for(var t=e.querySelectorAll(r.css),n=0;n<t.length;n++)i.push(t[n])}));else if(r instanceof Element){var o=!1;if(t.implicitLoop(n,(function(e){e.contains(r)&&(o=!0)})),o)return r}else t.implicitLoop(r,(function(e){t.implicitLoop(n,(function(t){e===t&&i.push(e)}))}));return i},evaluate:function(e){return t.unifiedEval(this,e)}};return e.parseElement("indirectExpression",r,i)}})),t.addIndirectExpression("asExpression",(function(e,t,r,n){if(r.matchToken("as")){r.matchToken("a")||r.matchToken("an");var i=e.requireElement("dotOrColonPath",r).evaluate(),o={type:"asExpression",root:n,args:[n],op:function(e,r){return t.convertValue(r,i)},evaluate:function(e){return t.unifiedEval(this,e)}};return e.parseElement("indirectExpression",r,o)}})),t.addIndirectExpression("functionCall",(function(e,t,r,n){if(r.matchOpToken("(")){var i=[];if(!r.matchOpToken(")")){do{i.push(e.requireElement("expression",r))}while(r.matchOpToken(","));r.requireOpToken(")")}if(n.root)var o={type:"functionCall",root:n,argExressions:i,args:[n.root,i],op:function(e,r,i){t.nullCheck(r,n.root);var o=r[n.prop.value];return t.nullCheck(o,n),o.hyperfunc&&i.push(e),o.apply(r,i)},evaluate:function(e){return t.unifiedEval(this,e)}};else o={type:"functionCall",root:n,argExressions:i,args:[n,i],op:function(e,r,i){return t.nullCheck(r,n),r.hyperfunc&&i.push(e),r.apply(null,i)},evaluate:function(e){return t.unifiedEval(this,e)}};return e.parseElement("indirectExpression",r,o)}})),t.addIndirectExpression("attributeRefAccess",(function(e,t,r,n){var i=e.parseElement("attributeRef",r);if(i)return{type:"attributeRefAccess",root:n,attribute:i,args:[n],op:function(e,r){return t.resolveAttribute(r,i.name)},evaluate:function(e){return t.unifiedEval(this,e)}}})),t.addIndirectExpression("arrayIndex",(function(e,t,r,n){if(r.matchOpToken("[")){var i=!1,o=!1,a=null,s=null;if(r.matchOpToken(".."))i=!0,a=e.requireElement("expression",r);else if(a=e.requireElement("expression",r),r.matchOpToken(".."))o=!0,"R_BRACKET"!==r.currentToken().type&&(s=e.parseElement("expression",r));r.requireOpToken("]");var u={type:"arrayIndex",root:n,prop:a,firstIndex:a,secondIndex:s,args:[n,a,s],op:function(e,t,r,n){return null==t?null:i?(r<0&&(r=t.length+r),t.slice(0,r+1)):o?null!=n?(n<0&&(n=t.length+n),t.slice(r,n+1)):t.slice(r):t[r]},evaluate:function(e){return t.unifiedEval(this,e)}};return e.parseElement("indirectExpression",r,u)}}));var o=["em","ex","cap","ch","ic","rem","lh","rlh","vw","vh","vi","vb","vmin","vmax","cm","mm","Q","pc","pt","px"];t.addGrammarElement("postfixExpression",(function(e,t,r){var n=e.parseElement("primaryExpression",r);let i=r.matchAnyToken.apply(r,o)||r.matchOpToken("%");if(i)return{type:"stringPostfix",postfix:i.value,args:[n],op:function(e,t){return""+t+i.value},evaluate:function(e){return t.unifiedEval(this,e)}};var a=null;if(r.matchToken("s")||r.matchToken("seconds")?a=1e3:(r.matchToken("ms")||r.matchToken("milliseconds"))&&(a=1),a)return{type:"timeExpression",time:n,factor:a,args:[n],op:function(e,t){return t*a},evaluate:function(e){return t.unifiedEval(this,e)}};if(r.matchOpToken(":")){var s=r.requireTokenType("IDENTIFIER");if(!s.value)return;var u=!r.matchOpToken("!");return{type:"typeCheck",typeName:s,nullOk:u,args:[n],op:function(e,r){if(t.typeCheck(r,this.typeName.value,u))return r;throw new Error("Typecheck failed!  Expected: "+s.value)},evaluate:function(e){return t.unifiedEval(this,e)}}}return n})),t.addGrammarElement("logicalNot",(function(e,t,r){if(r.matchToken("not")){var n=e.requireElement("unaryExpression",r);return{type:"logicalNot",root:n,args:[n],op:function(e,t){return!t},evaluate:function(e){return t.unifiedEval(this,e)}}}})),t.addGrammarElement("noExpression",(function(e,t,r){if(r.matchToken("no")){var n=e.requireElement("unaryExpression",r);return{type:"noExpression",root:n,args:[n],op:function(e,r){return t.isEmpty(r)},evaluate:function(e){return t.unifiedEval(this,e)}}}})),t.addLeafExpression("some",(function(e,t,r){if(r.matchToken("some")){var n=e.requireElement("expression",r);return{type:"noExpression",root:n,args:[n],op:function(e,r){return!t.isEmpty(r)},evaluate(e){return t.unifiedEval(this,e)}}}})),t.addGrammarElement("negativeNumber",(function(e,t,r){if(r.matchOpToken("-")){var n=e.requireElement("unaryExpression",r);return{type:"negativeNumber",root:n,args:[n],op:function(e,t){return-1*t},evaluate:function(e){return t.unifiedEval(this,e)}}}})),t.addGrammarElement("unaryExpression",(function(e,t,r){return r.matchToken("the"),e.parseAnyOf(["beepExpression","logicalNot","relativePositionalExpression","positionalExpression","noExpression","negativeNumber","postfixExpression"],r)})),t.addGrammarElement("beepExpression",(function(e,t,r){if(r.matchToken("beep!")){var n=e.parseElement("unaryExpression",r);if(void 0!==n){n.booped=!0;var i=n.evaluate;return n.evaluate=function(e){let r=i.apply(n,arguments),o=e.me;return t.beepValueToConsole(o,n,r),r},n}}}));var s=function(e,t,r,n){var i=[];a.prototype.forEach(t,(function(t){(t.matches(r)||t===e)&&i.push(t)}));for(var o=0;o<i.length-1;o++){if(i[o]===e)return i[o+1]}if(n){var s=i[0];if(s&&s.matches(r))return s}};function u(e,t,r){if(t.contains)return t.contains(r);if(t.includes)return t.includes(r);throw Error("The value of "+e.sourceFor()+" does not have a contains or includes method on it")}function l(e,t,r){if(t.match)return!!t.match(r);if(t.matches)return t.matches(r);throw Error("The value of "+e.sourceFor()+" does not have a match or matches method on it")}t.addGrammarElement("relativePositionalExpression",(function(e,t,r){var n=r.matchAnyToken("next","previous");if(n){var o="next"===n.value,a=e.parseElement("expression",r);if(r.matchToken("from")){r.pushFollow("in");try{var u=e.requireElement("unaryExpression",r)}finally{r.popFollow()}}else u=e.requireElement("implicitMeTarget",r);var l,c,m=!1;r.matchToken("in")?(m=!0,l=e.requireElement("unaryExpression",r)):c=r.matchToken("within")?e.requireElement("unaryExpression",r):document.body;var p=!1;return r.matchToken("with")&&(r.requireToken("wrapping"),p=!0),{type:"relativePositionalExpression",from:u,forwardSearch:o,inSearch:m,wrapping:p,inElt:l,withinElt:c,operator:n.value,args:[a,u,l,c],op:function(e,t,r,n,u){var l,c,f,h=t.css;if(null==h)throw"Expected a CSS value to be returned by "+i.sourceFor.apply(a);if(m){if(void 0!==n)return o?s(r,n,h,p):(l=n,c=h,f=p,s(r,Array.from(l).reverse(),c,f))}else if(void 0!==u)return o?function(e,t,r,n){for(var i=t.querySelectorAll(r),o=0;o<i.length;o++){var a=i[o];if(a.compareDocumentPosition(e)===Node.DOCUMENT_POSITION_PRECEDING)return a}if(n)return i[0]}(r,u,h,p):function(e,t,r,n){for(var i=t.querySelectorAll(r),o=i.length-1;o>=0;o--){var a=i[o];if(a.compareDocumentPosition(e)===Node.DOCUMENT_POSITION_FOLLOWING)return a}if(n)return i[i.length-1]}(r,u,h,p)},evaluate:function(e){return t.unifiedEval(this,e)}}}})),t.addGrammarElement("positionalExpression",(function(e,t,r){var n=r.matchAnyToken("first","last","random");if(!n)return;r.matchAnyToken("in","from","of");var i=e.requireElement("unaryExpression",r);const o=n.value;return{type:"positionalExpression",rhs:i,operator:n.value,args:[i],op:function(e,t){if(t&&!Array.isArray(t)&&(t=t.children?t.children:Array.from(t)),t){if("first"===o)return t[0];if("last"===o)return t[t.length-1];if("random"===o)return t[Math.floor(Math.random()*t.length)]}},evaluate:function(e){return t.unifiedEval(this,e)}}})),t.addGrammarElement("mathOperator",(function(e,t,r){var n,i=e.parseElement("unaryExpression",r),o=null;for(n=r.matchAnyOpToken("+","-","*","/")||r.matchToken("mod");n;){o=o||n;var a=n.value;o.value!==a&&e.raiseParseError(r,"You must parenthesize math operations with different operators");var s=e.parseElement("unaryExpression",r);i={type:"mathOperator",lhs:i,rhs:s,operator:a,args:[i,s],op:function(e,t,r){return"+"===a?t+r:"-"===a?t-r:"*"===a?t*r:"/"===a?t/r:"mod"===a?t%r:void 0},evaluate:function(e){return t.unifiedEval(this,e)}},n=r.matchAnyOpToken("+","-","*","/")||r.matchToken("mod")}return i})),t.addGrammarElement("mathExpression",(function(e,t,r){return e.parseAnyOf(["mathOperator","unaryExpression"],r)})),t.addGrammarElement("comparisonOperator",(function(e,t,r){var n=e.parseElement("mathExpression",r),i=r.matchAnyOpToken("<",">","<=",">=","==","===","!=","!=="),o=void 0!==i?i.value:void 0,a=!0,s=!1;if(void 0===o&&(r.matchToken("is")||r.matchToken("am")?r.matchToken("not")?r.matchToken("in")?o="not in":r.matchToken("a")?(o="not a",s=!0):r.matchToken("empty")?(o="not empty",a=!1):(o=r.matchToken("really")?"!==":"!=",r.matchToken("equal")&&r.matchToken("to")):r.matchToken("in")?o="in":r.matchToken("a")?(o="a",s=!0):r.matchToken("empty")?(o="empty",a=!1):r.matchToken("less")?(r.requireToken("than"),r.matchToken("or")?(r.requireToken("equal"),r.requireToken("to"),o="<="):o="<"):r.matchToken("greater")?(r.requireToken("than"),r.matchToken("or")?(r.requireToken("equal"),r.requireToken("to"),o=">="):o=">"):(o=r.matchToken("really")?"===":"==",r.matchToken("equal")&&r.matchToken("to")):r.matchToken("equals")?o="==":r.matchToken("really")?(r.requireToken("equals"),o="==="):r.matchToken("exist")||r.matchToken("exists")?(o="exist",a=!1):r.matchToken("matches")||r.matchToken("match")?o="match":r.matchToken("contains")||r.matchToken("contain")?o="contain":r.matchToken("includes")||r.matchToken("include")?o="include":(r.matchToken("do")||r.matchToken("does"))&&(r.requireToken("not"),r.matchToken("matches")||r.matchToken("match")?o="not match":r.matchToken("contains")||r.matchToken("contain")?o="not contain":r.matchToken("exist")||r.matchToken("exist")?(o="not exist",a=!1):r.matchToken("include")?o="not include":e.raiseParseError(r,"Expected matches or contains"))),void 0!==o){var c,m,p;s?(c=r.requireTokenType("IDENTIFIER"),m=!r.matchOpToken("!")):a&&(p=e.requireElement("mathExpression",r),"match"!==o&&"not match"!==o||(p=p.css?p.css:p));var f=n;n={type:"comparisonOperator",operator:o,typeName:c,nullOk:m,lhs:n,rhs:p,args:[n,p],op:function(e,r,n){if("=="===o)return r==n;if("!="===o)return r!=n;if("==="===o)return r===n;if("!=="===o)return r!==n;if("match"===o)return null!=r&&l(f,r,n);if("not match"===o)return null==r||!l(f,r,n);if("in"===o)return null!=n&&u(p,n,r);if("not in"===o)return null==n||!u(p,n,r);if("contain"===o)return null!=r&&u(f,r,n);if("not contain"===o)return null==r||!u(f,r,n);if("include"===o)return null!=r&&u(f,r,n);if("not include"===o)return null==r||!u(f,r,n);if("==="===o)return r===n;if("!=="===o)return r!==n;if("<"===o)return r<n;if(">"===o)return r>n;if("<="===o)return r<=n;if(">="===o)return r>=n;if("empty"===o)return t.isEmpty(r);if("not empty"===o)return!t.isEmpty(r);if("exist"===o)return t.doesExist(r);if("not exist"===o)return!t.doesExist(r);if("a"===o)return t.typeCheck(r,c.value,m);if("not a"===o)return!t.typeCheck(r,c.value,m);throw"Unknown comparison : "+o},evaluate:function(e){return t.unifiedEval(this,e)}}}return n})),t.addGrammarElement("comparisonExpression",(function(e,t,r){return e.parseAnyOf(["comparisonOperator","mathExpression"],r)})),t.addGrammarElement("logicalOperator",(function(e,t,r){var n,i=e.parseElement("comparisonExpression",r),o=null;for(n=r.matchToken("and")||r.matchToken("or");n;){(o=o||n).value!==n.value&&e.raiseParseError(r,"You must parenthesize logical operations with different operators");var a=e.requireElement("comparisonExpression",r);const s=n.value;i={type:"logicalOperator",operator:s,lhs:i,rhs:a,args:[i,a],op:function(e,t,r){return"and"===s?t&&r:t||r},evaluate:function(e){return t.unifiedEval(this,e)}},n=r.matchToken("and")||r.matchToken("or")}return i})),t.addGrammarElement("logicalExpression",(function(e,t,r){return e.parseAnyOf(["logicalOperator","mathExpression"],r)})),t.addGrammarElement("asyncExpression",(function(e,t,r){return r.matchToken("async")?{type:"asyncExpression",value:e.requireElement("logicalExpression",r),evaluate:function(e){return{asyncWrapper:!0,value:this.value.evaluate(e)}}}:e.parseElement("logicalExpression",r)})),t.addGrammarElement("expression",(function(e,t,r){return r.matchToken("the"),e.parseElement("asyncExpression",r)})),t.addGrammarElement("assignableExpression",(function(e,t,r){r.matchToken("the");var n=e.parseElement("primaryExpression",r);return!n||"symbol"!==n.type&&"ofExpression"!==n.type&&"propertyAccess"!==n.type&&"attributeRefAccess"!==n.type&&"attributeRef"!==n.type&&"styleRef"!==n.type&&"arrayIndex"!==n.type&&"possessive"!==n.type?(e.raiseParseError(r,"A target expression must be writable.  The expression type '"+(n&&n.type)+"' is not."),n):n})),t.addGrammarElement("hyperscript",(function(e,t,r){var n=[];if(r.hasMore())for(;e.featureStart(r.currentToken())||"("===r.currentToken().value;){var i=e.requireElement("feature",r);n.push(i),r.matchToken("end")}return{type:"hyperscript",features:n,apply:function(e,t,r){for(const i of n)i.install(e,t,r)}}}));var c=function(e){var t=[];if("("===e.token(0).value&&(")"===e.token(1).value||","===e.token(2).value||")"===e.token(2).value)){e.matchOpToken("(");do{t.push(e.requireTokenType("IDENTIFIER"))}while(e.matchOpToken(","));e.requireOpToken(")")}return t};function m(e,t,r,n){var i=t.requireElement("eventName",n),o=t.parseElement("namedArgumentList",n);if("send"===e&&n.matchToken("to")||"trigger"===e&&n.matchToken("on"))var a=t.requireElement("expression",n);else a=t.requireElement("implicitMeTarget",n);var s={eventName:i,details:o,to:a,args:[a,i,o],op:function(e,t,n,i){return r.nullCheck(t,a),r.implicitLoop(t,(function(t){r.triggerEvent(t,n,i,e.me)})),r.findNext(s,e)}};return s}t.addFeature("on",(function(e,t,r){if(r.matchToken("on")){var n=!1;r.matchToken("every")&&(n=!0);var i=[],o=null;do{var a=e.requireElement("eventName",r,"Expected event name").evaluate();o=o?o+" or "+a:"on "+a;var s,u,l,m,p,f=c(r),h=null;if(r.matchOpToken("[")&&(h=e.requireElement("expression",r),r.requireOpToken("]")),"NUMBER"===r.currentToken().type){var d=r.consumeToken();if(!d.value)return;if(s=parseInt(d.value),r.matchToken("to")){var v=r.consumeToken();if(!v.value)return;u=parseInt(v.value)}else r.matchToken("and")&&(l=!0,r.requireToken("on"))}if("intersection"===a){if(m={},r.matchToken("with")&&(m.with=e.requireElement("expression",r).evaluate()),r.matchToken("having"))do{r.matchToken("margin")?m.rootMargin=e.requireElement("stringLike",r).evaluate():r.matchToken("threshold")?m.threshold=e.requireElement("expression",r).evaluate():e.raiseParseError(r,"Unknown intersection config specification")}while(r.matchToken("and"))}else if("mutation"===a)if(p={},r.matchToken("of"))do{if(r.matchToken("anything"))p.attributes=!0,p.subtree=!0,p.characterData=!0,p.childList=!0;else if(r.matchToken("childList"))p.childList=!0;else if(r.matchToken("attributes"))p.attributes=!0,p.attributeOldValue=!0;else if(r.matchToken("subtree"))p.subtree=!0;else if(r.matchToken("characterData"))p.characterData=!0,p.characterDataOldValue=!0;else if("ATTRIBUTE_REF"===r.currentToken().type){var E=r.consumeToken();null==p.attributeFilter&&(p.attributeFilter=[]),0==E.value.indexOf("@")?p.attributeFilter.push(E.value.substring(1)):e.raiseParseError(r,"Only shorthand attribute references are allowed here")}else e.raiseParseError(r,"Unknown mutation config specification")}while(r.matchToken("or"));else p.attributes=!0,p.characterData=!0,p.childList=!0;var T=void 0,y=!1;if(r.matchToken("from"))if(r.matchToken("elsewhere"))y=!0;else{r.pushFollow("or");try{T=e.requireElement("expression",r)}finally{r.popFollow()}void 0===T&&e.raiseParseError(r,'Expected either target value or "elsewhere".')}if(void 0===T&&!1===y&&r.matchToken("elsewhere")&&(y=!0),r.matchToken("in"))var k=e.parseElement("unaryExpression",r);if(r.matchToken("debounced")){r.requireToken("at");var x=e.requireElement("unaryExpression",r).evaluate({})}else if(r.matchToken("throttled")){r.requireToken("at");var g=e.requireElement("unaryExpression",r).evaluate({})}i.push({execCount:0,every:n,on:a,args:f,filter:h,from:T,inExpr:k,elsewhere:y,startCount:s,endCount:u,unbounded:l,debounceTime:x,throttleTime:g,mutationSpec:p,intersectionSpec:m,debounced:void 0,lastExec:void 0})}while(r.matchToken("or"));var b=!0;if(!n&&r.matchToken("queue"))if(r.matchToken("all"))b=!1;else if(r.matchToken("first"))var S=!0;else if(r.matchToken("none"))var q=!0;else r.requireToken("last");var N,w,I=e.requireElement("commandList",r);if(e.ensureTerminated(I),r.matchToken("catch")&&(N=r.requireTokenType("IDENTIFIER").value,w=e.requireElement("commandList",r),e.ensureTerminated(w)),r.matchToken("finally")){var C=e.requireElement("commandList",r);e.ensureTerminated(C)}var R={displayName:o,events:i,start:I,every:n,execCount:0,errorHandler:w,errorSymbol:N,execute:function(e){let r=t.getEventQueueFor(e.me,R);if(r.executing&&!1===n){if(q||S&&r.queue.length>0)return;return b&&(r.queue.length=0),void r.queue.push(e)}R.execCount++,r.executing=!0,e.meta.onHalt=function(){r.executing=!1;var e=r.queue.shift();e&&setTimeout((function(){R.execute(e)}),1)},e.meta.reject=function(r){console.error(r.message?r.message:r);var n=t.getHyperTrace(e,r);n&&n.print(),t.triggerEvent(e.me,"exception",{error:r})},I.execute(e)},install:function(e,r){for(const r of R.events){var n;n=r.elsewhere?[document]:void 0!==r.from?r.from.evaluate(t.makeContext(e,R,e,null)):[e],t.implicitLoop(n,(function(n){var i=r.on;if(null!=n){if(r.mutationSpec){i="hyperscript:mutation";new MutationObserver((function(e,r){R.executing||t.triggerEvent(n,i,{mutationList:e,observer:r})})).observe(n,r.mutationSpec)}if(r.intersectionSpec){i="hyperscript:intersection";const e=new IntersectionObserver((function(r){for(const a of r){var o={observer:e};(o=Object.assign(o,a)).intersecting=a.isIntersecting,t.triggerEvent(n,i,o)}}),r.intersectionSpec);e.observe(n)}(n.addEventListener||n.on).call(n,i,(function o(a){if("undefined"!=typeof Node&&e instanceof Node&&n!==e&&!e.isConnected)n.removeEventListener(i,o);else{var s=t.makeContext(e,R,e,a);if(!r.elsewhere||!e.contains(a.target)){r.from&&(s.result=n);for(const e of r.args){let t=s.event[e.value];void 0!==t?s.locals[e.value]=t:"detail"in s.event&&(s.locals[e.value]=s.event.detail[e.value])}if(s.meta.errorHandler=w,s.meta.errorSymbol=N,s.meta.finallyHandler=C,r.filter){var u=s.meta.context;s.meta.context=s.event;try{if(!r.filter.evaluate(s))return}finally{s.meta.context=u}}if(r.inExpr)for(var l=a.target;;){if(l.matches&&l.matches(r.inExpr.css)){s.result=l;break}if(null==(l=l.parentElement))return}if(r.execCount++,r.startCount)if(r.endCount){if(r.execCount<r.startCount||r.execCount>r.endCount)return}else if(r.unbounded){if(r.execCount<r.startCount)return}else if(r.execCount!==r.startCount)return;if(void 0!==r.debounceTime)return void 0!==r.debounced&&clearTimeout(r.debounced),void(r.debounced=setTimeout((function(){R.execute(s)}),r.debounceTime));if(r.throttleTime){if(r.lastExec&&Date.now()<r.lastExec+r.throttleTime)return;r.lastExec=Date.now()}R.execute(s)}}}))}else console.warn("'%s' feature ignored because target does not exists:",o,e)}))}}};return e.setParent(I,R),R}})),t.addFeature("def",(function(e,t,r){if(r.matchToken("def")){var n=e.requireElement("dotOrColonPath",r).evaluate(),i=n.split("."),o=i.pop(),a=[];if(r.matchOpToken("("))if(r.matchOpToken(")"));else{do{a.push(r.requireTokenType("IDENTIFIER"))}while(r.matchOpToken(","));r.requireOpToken(")")}var s,u,l,c=e.requireElement("commandList",r);r.matchToken("catch")&&(s=r.requireTokenType("IDENTIFIER").value,u=e.parseElement("commandList",r)),r.matchToken("finally")&&(l=e.requireElement("commandList",r),e.ensureTerminated(l));var m={displayName:o+"("+a.map((function(e){return e.value})).join(", ")+")",name:o,args:a,start:c,errorHandler:u,errorSymbol:s,finallyHandler:l,install:function(e,r){var p=function(){var n=t.makeContext(r,m,e,null);n.meta.errorHandler=u,n.meta.errorSymbol=s,n.meta.finallyHandler=l;for(var i=0;i<a.length;i++){var o=a[i],p=arguments[i];o&&(n.locals[o.value]=p)}n.meta.caller=arguments[a.length],n.meta.caller&&(n.meta.callingCommand=n.meta.caller.meta.command);var f,h=null,d=new Promise((function(e,t){f=e,h=t}));return c.execute(n),n.meta.returned?n.meta.returnValue:(n.meta.resolve=f,n.meta.reject=h,d)};p.hyperfunc=!0,p.hypername=n,t.assignToNamespace(e,i,o,p)}};return e.ensureTerminated(c),u&&e.ensureTerminated(u),e.setParent(c,m),m}})),t.addFeature("set",(function(e,t,r){let n=e.parseElement("setCommand",r);if(n){"element"!==n.target.scope&&e.raiseParseError(r,"variables declared at the feature level must be element scoped.");let i={start:n,install:function(e,r){n&&n.execute(t.makeContext(e,i,e,null))}};return e.ensureTerminated(n),i}})),t.addFeature("init",(function(e,t,r){if(r.matchToken("init")){var n=r.matchToken("immediately"),i=e.requireElement("commandList",r),o={start:i,install:function(e,r){let a=function(){i&&i.execute(t.makeContext(e,o,e,null))};n?a():setTimeout(a,0)}};return e.ensureTerminated(i),e.setParent(i,o),o}})),t.addFeature("worker",(function(e,t,r){r.matchToken("worker")&&e.raiseParseError(r,"In order to use the 'worker' feature, include the _hyperscript worker plugin. See https://hyperscript.org/features/worker/ for more info.")})),t.addFeature("behavior",(function(t,r,n){if(n.matchToken("behavior")){var i=t.requireElement("dotOrColonPath",n).evaluate(),o=i.split("."),a=o.pop(),s=[];if(n.matchOpToken("(")&&!n.matchOpToken(")")){do{s.push(n.requireTokenType("IDENTIFIER").value)}while(n.matchOpToken(","));n.requireOpToken(")")}for(var u=t.requireElement("hyperscript",n),l=0;l<u.features.length;l++){u.features[l].behavior=i}return{install:function(t,n){r.assignToNamespace(e.document&&e.document.body,o,a,(function(e,t,n){for(var o=h(r.getInternalData(e),i+"Scope"),a=0;a<s.length;a++)o[s[a]]=n[s[a]];u.apply(e,t)}))}}}})),t.addFeature("install",(function(t,r,n){if(n.matchToken("install")){var i,o=t.requireElement("dotOrColonPath",n).evaluate(),a=o.split("."),s=t.parseElement("namedArgumentList",n);return i={install:function(t,n){r.unifiedEval({args:[s],op:function(r,i){for(var s=e,u=0;u<a.length;u++)if("object"!=typeof(s=s[a[u]])&&"function"!=typeof s)throw new Error("No such behavior defined as "+o);if(!(s instanceof Function))throw new Error(o+" is not a behavior");s(t,n,i)}},r.makeContext(t,i,t,null))}}}})),t.addGrammarElement("jsBody",(function(e,t,r){for(var n=r.currentToken().start,i=r.currentToken(),o=[],a="",s=!1;r.hasMore();){i=r.consumeToken();var u=r.token(0,!0);if("IDENTIFIER"===u.type&&"end"===u.value)break;s?"IDENTIFIER"===i.type||"NUMBER"===i.type?a+=i.value:(""!==a&&o.push(a),a="",s=!1):"IDENTIFIER"===i.type&&"function"===i.value&&(s=!0)}var l=i.end+1;return{type:"jsBody",exposedFunctionNames:o,jsSource:r.source.substring(n,l)}})),t.addFeature("js",(function(t,r,n){if(n.matchToken("js")){var i=t.requireElement("jsBody",n),o=i.jsSource+"\nreturn { "+i.exposedFunctionNames.map((function(e){return e+":"+e})).join(",")+" } ",a=new Function(o);return{jsSource:o,function:a,exposedFunctionNames:i.exposedFunctionNames,install:function(){Object.assign(e,a())}}}})),t.addCommand("js",(function(t,r,n){if(n.matchToken("js")){var i=[];if(n.matchOpToken("("))if(n.matchOpToken(")"));else{do{var o=n.requireTokenType("IDENTIFIER");i.push(o.value)}while(n.matchOpToken(","));n.requireOpToken(")")}var a=t.requireElement("jsBody",n);n.matchToken("end");var s=v(Function,i.concat([a.jsSource]));return{jsSource:a.jsSource,function:s,inputs:i,op:function(t){var n=[];i.forEach((function(e){n.push(r.resolveSymbol(e,t,"default"))}));var o=s.apply(e,n);return o&&"function"==typeof o.then?new Promise((e=>{o.then((n=>{t.result=n,e(r.findNext(this,t))}))})):(t.result=o,r.findNext(this,t))}}}})),t.addCommand("async",(function(e,t,r){if(r.matchToken("async")){if(r.matchToken("do")){for(var n=i=e.requireElement("commandList",r);n.next;)n=n.next;n.next=t.HALT,r.requireToken("end")}else var i=e.requireElement("command",r);var o={body:i,op:function(e){return setTimeout((function(){i.execute(e)})),t.findNext(this,e)}};return e.setParent(i,o),o}})),t.addCommand("tell",(function(e,t,r){var n=r.currentToken();if(r.matchToken("tell")){var i=e.requireElement("expression",r),o=e.requireElement("commandList",r);r.hasMore()&&!e.featureStart(r.currentToken())&&r.requireToken("end");var a="tell_"+n.start,s={value:i,body:o,args:[i],resolveNext:function(e){var r=e.meta.iterators[a];return r.index<r.value.length?(e.you=r.value[r.index++],o):(e.you=r.originalYou,this.next?this.next:t.findNext(this.parent,e))},op:function(e,t){return null==t?t=[]:Array.isArray(t)||t instanceof NodeList||(t=[t]),e.meta.iterators[a]={originalYou:e.you,index:0,value:t},this.resolveNext(e)}};return e.setParent(o,s),s}})),t.addCommand("wait",(function(e,t,r){if(r.matchToken("wait")){var n,i;if(r.matchToken("for")){r.matchToken("a");var o,a=[];do{var s=r.token(0);"NUMBER"===s.type||"L_PAREN"===s.type?a.push({time:e.requireElement("expression",r).evaluate()}):a.push({name:e.requireElement("dotOrColonPath",r,"Expected event name").evaluate(),args:c(r)})}while(r.matchToken("or"));return r.matchToken("from")&&(o=e.requireElement("expression",r)),n={event:a,on:o,args:[o],op:function(e,r){var n=r||e.me;if(!(n instanceof EventTarget))throw new Error("Not a valid event target: "+this.on.sourceFor());return new Promise((r=>{var i=!1;for(const s of a){var o=n=>{if(e.result=n,s.args)for(const t of s.args)e.locals[t.value]=n[t.value]||(n.detail?n.detail[t.value]:null);i||(i=!0,r(t.findNext(this,e)))};s.name?n.addEventListener(s.name,o,{once:!0}):null!=s.time&&setTimeout(o,s.time,s.time)}}))}},n}return r.matchToken("a")?(r.requireToken("tick"),i=0):i=e.requireElement("expression",r),n={type:"waitCmd",time:i,args:[i],op:function(e,r){return new Promise((n=>{setTimeout((()=>{n(t.findNext(this,e))}),r)}))},execute:function(e){return t.unifiedExec(this,e)}}}})),t.addGrammarElement("dotOrColonPath",(function(e,t,r){var n=r.matchTokenType("IDENTIFIER");if(n){var i=[n.value],o=r.matchOpToken(".")||r.matchOpToken(":");if(o)do{i.push(r.requireTokenType("IDENTIFIER","NUMBER").value)}while(r.matchOpToken(o.value));return{type:"dotOrColonPath",path:i,evaluate:function(){return i.join(o?o.value:"")}}}})),t.addGrammarElement("eventName",(function(e,t,r){var n;return(n=r.matchTokenType("STRING"))?{evaluate:function(){return n.value}}:e.parseElement("dotOrColonPath",r)})),t.addCommand("trigger",(function(e,t,r){if(r.matchToken("trigger"))return m("trigger",e,t,r)})),t.addCommand("send",(function(e,t,r){if(r.matchToken("send"))return m("send",e,t,r)}));var f=function(e,t,r,n){if(n)if(e.commandBoundary(r.currentToken()))e.raiseParseError(r,"'return' commands must return a value.  If you do not wish to return a value, use 'exit' instead.");else var i=e.requireElement("expression",r);var o={value:i,args:[i],op:function(e,r){var n=e.meta.resolve;return e.meta.returned=!0,e.meta.returnValue=r,n&&(r?n(r):n()),t.HALT}};return o};t.addCommand("return",(function(e,t,r){if(r.matchToken("return"))return f(e,t,r,!0)})),t.addCommand("exit",(function(e,t,r){if(r.matchToken("exit"))return f(e,t,r,!1)})),t.addCommand("halt",(function(e,t,r){if(r.matchToken("halt")){if(r.matchToken("the")){r.requireToken("event"),r.matchOpToken("'")&&r.requireToken("s");var n=!0}var i,o;r.matchToken("bubbling")?i=!0:r.matchToken("default")&&(o=!0);var a=f(e,t,r,!1);return{keepExecuting:!0,bubbling:i,haltDefault:o,exit:a,op:function(e){if(e.event)return i?e.event.stopPropagation():(o||e.event.stopPropagation(),e.event.preventDefault()),n?t.findNext(this,e):a}}}})),t.addCommand("log",(function(e,t,r){if(r.matchToken("log")){for(var n,i=[e.parseElement("expression",r)];r.matchOpToken(",");)i.push(e.requireElement("expression",r));r.matchToken("with")&&(n=e.requireElement("expression",r));var o={exprs:i,withExpr:n,args:[n,i],op:function(e,r,n){return r?r.apply(null,n):console.log.apply(null,n),t.findNext(this,e)}};return o}})),t.addCommand("beep!",(function(e,t,r){if(r.matchToken("beep!")){for(var n=[e.parseElement("expression",r)];r.matchOpToken(",");)n.push(e.requireElement("expression",r));return{exprs:n,args:[n],op:function(e,r){for(let i=0;i<n.length;i++){const o=n[i],a=r[i];t.beepValueToConsole(e.me,o,a)}return t.findNext(this,e)}}}})),t.addCommand("throw",(function(e,t,r){if(r.matchToken("throw")){var n=e.requireElement("expression",r),i={expr:n,args:[n],op:function(e,r){throw t.registerHyperTrace(e,r),r}};return i}}));var d=function(e,t,r){var n=e.requireElement("expression",r),i={expr:n,args:[n],op:function(e,r){return e.result=r,t.findNext(i,e)}};return i};t.addCommand("call",(function(e,t,r){if(r.matchToken("call")){var n=d(e,t,r);return n.expr&&"functionCall"!==n.expr.type&&e.raiseParseError(r,"Must be a function invocation"),n}})),t.addCommand("get",(function(e,t,r){if(r.matchToken("get"))return d(e,t,r)})),t.addCommand("make",(function(e,t,r){if(r.matchToken("make")){r.matchToken("a")||r.matchToken("an");var n,i,o=e.requireElement("expression",r),a=[];if("queryRef"!==o.type&&r.matchToken("from"))do{a.push(e.requireElement("expression",r))}while(r.matchOpToken(","));return r.matchToken("called")&&(n=e.requireElement("symbol",r)),"queryRef"===o.type?i={op:function(e){for(var r,i,a="div",s=[],u=/(?:(^|#|\.)([^#\. ]+))/g;r=u.exec(o.css);)""===r[1]?a=r[2].trim():"#"===r[1]?i=r[2].trim():s.push(r[2].trim());var l=document.createElement(a);void 0!==i&&(l.id=i);for(var c=0;c<s.length;c++){var m=s[c];l.classList.add(m)}return e.result=l,n&&t.setSymbol(n.name,e,n.scope,l),t.findNext(this,e)}}:(i={args:[o,a],op:function(e,r,i){return e.result=v(r,i),n&&t.setSymbol(n.name,e,n.scope,e.result),t.findNext(this,e)}},i)}})),t.addGrammarElement("pseudoCommand",(function(e,t,r){let n=r.token(1);if(n&&n.op&&("."===n.value||"("===n.value)){for(var i,o,a=e.requireElement("primaryExpression",r),s=a.root,u=a;void 0!==s.root;)u=u.root,s=s.root;return"functionCall"!==a.type&&e.raiseParseError(r,"Pseudo-commands must be function calls"),"functionCall"===u.type&&null==u.root.root&&(r.matchAnyToken("the","to","on","with","into","from","at")?i=e.requireElement("expression",r):r.matchToken("me")&&(i=e.requireElement("implicitMeTarget",r))),o=i?{type:"pseudoCommand",root:i,argExpressions:u.argExpressions,args:[i,u.argExpressions],op:function(e,r,n){t.nullCheck(r,i);var a=r[u.root.name];return t.nullCheck(a,u),a.hyperfunc&&n.push(e),e.result=a.apply(r,n),t.findNext(o,e)},execute:function(e){return t.unifiedExec(this,e)}}:{type:"pseudoCommand",expr:a,args:[a],op:function(e,r){return e.result=r,t.findNext(o,e)},execute:function(e){return t.unifiedExec(this,e)}},o}}));var E=function(e,t,r,n,i){var o="symbol"===n.type,a="attributeRef"===n.type,s="styleRef"===n.type,u="arrayIndex"===n.type;a||s||o||null!=n.root||e.raiseParseError(r,"Can only put directly into symbols, not references");var l=null,c=null;if(o);else if(a||s){l=e.requireElement("implicitMeTarget",r);var m=n}else if(u)c=n.firstIndex,l=n.root;else{c=n.prop?n.prop.value:null;m=n.attribute;l=n.root}var p={target:n,symbolWrite:o,value:i,args:[l,c,i],op:function(e,r,i,a){return o?t.setSymbol(n.name,e,n.scope,a):(t.nullCheck(r,l),u?r[i]=a:t.implicitLoop(r,(function(e){m?"attributeRef"===m.type?null==a?e.removeAttribute(m.name):e.setAttribute(m.name,a):e.style[m.name]=a:e[i]=a}))),t.findNext(this,e)}};return p};t.addCommand("default",(function(e,t,r){if(r.matchToken("default")){var n=e.requireElement("assignableExpression",r);r.requireToken("to");var i=e.requireElement("expression",r),o=E(e,t,r,n,i),a={target:n,value:i,setter:o,args:[n],op:function(e,r){return r?t.findNext(this,e):o}};return o.parent=a,a}})),t.addCommand("set",(function(e,t,r){if(r.matchToken("set")){if("L_BRACE"===r.currentToken().type){var n=e.requireElement("objectLiteral",r);r.requireToken("on");var i={objectLiteral:n,target:o=e.requireElement("expression",r),args:[n,o],op:function(e,r,n){return Object.assign(n,r),t.findNext(this,e)}};return i}try{r.pushFollow("to");var o=e.requireElement("assignableExpression",r)}finally{r.popFollow()}r.requireToken("to");var a=e.requireElement("expression",r);return E(e,t,r,o,a)}})),t.addCommand("if",(function(e,t,r){if(!r.matchToken("if"))return;var n=e.requireElement("expression",r);r.matchToken("then");var i=e.parseElement("commandList",r),o=!1;let a=r.matchToken("else")||r.matchToken("otherwise");if(a){let t=r.peekToken("if");if(o=null!=t&&t.line===a.line)var s=e.parseElement("command",r);else s=e.parseElement("commandList",r)}r.hasMore()&&!o&&r.requireToken("end");var u={expr:n,trueBranch:i,falseBranch:s,args:[n],op:function(e,r){return r?i:s||t.findNext(this,e)}};return e.setParent(i,u),e.setParent(s,u),u}));var T=function(e,t,r,n){var i,o=t.currentToken(),a=!1,s=!1;if(t.matchToken("for")||n){var u=t.requireTokenType("IDENTIFIER");i=u.value,t.requireToken("in");var l=e.requireElement("expression",t)}else if(t.matchToken("in")){i="it";l=e.requireElement("expression",t)}else if(t.matchToken("while"))var c=e.requireElement("expression",t);else if(t.matchToken("until"))if(a=!0,t.matchToken("event")){var m=e.requireElement("dotOrColonPath",t,"Expected event name");if(t.matchToken("from"))var p=e.requireElement("expression",t)}else c=e.requireElement("expression",t);else if(e.commandBoundary(t.currentToken())||"forever"===t.currentToken().value)t.matchToken("forever"),s=!0;else{var f=e.requireElement("expression",t);t.requireToken("times")}if(t.matchToken("index"))var h=(u=t.requireTokenType("IDENTIFIER")).value;var d,v=e.parseElement("commandList",t);if(v&&m){for(var E=v;E.next;)E=E.next;var T={type:"waitATick",op:function(){return new Promise((function(e){setTimeout((function(){e(r.findNext(T))}),0)}))}};E.next=T}t.hasMore()&&t.requireToken("end"),null==i?(i="_implicit_repeat_"+o.start,d=i):d=i+"_"+o.start;var y={identifier:i,indexIdentifier:h,slot:d,expression:l,forever:s,times:f,until:a,event:m,on:p,whileExpr:c,resolveNext:function(){return this},loop:v,args:[c,f],op:function(e,t,n){var o=e.meta.iterators[d],a=!1,s=null;if(this.forever)a=!0;else if(this.until)a=m?!1===e.meta.iterators[d].eventFired:!0!==t;else if(c)a=t;else if(n)a=o.index<n;else{var u=o.iterator.next();a=!u.done,s=u.value}return a?(o.value?e.result=e.locals[i]=s:e.result=o.index,h&&(e.locals[h]=o.index),o.index++,v):(e.meta.iterators[d]=null,r.findNext(this.parent,e))}};e.setParent(v,y);var k={name:"repeatInit",args:[l,m,p],op:function(e,t,r,n){var i={index:0,value:t,eventFired:!1};(e.meta.iterators[d]=i,t&&t[Symbol.iterator]&&(i.iterator=t[Symbol.iterator]()),m)&&(n||e.me).addEventListener(r,(function(t){e.meta.iterators[d].eventFired=!0}),{once:!0});return y},execute:function(e){return r.unifiedExec(this,e)}};return e.setParent(y,k),k};t.addCommand("repeat",(function(e,t,r){if(r.matchToken("repeat"))return T(e,r,t,!1)})),t.addCommand("for",(function(e,t,r){if(r.matchToken("for"))return T(e,r,t,!0)})),t.addCommand("continue",(function(e,t,r){if(r.matchToken("continue"))return{op:function(t){for(var n=this.parent;;n=n.parent)if(null==n&&e.raiseParseError(r,"Command `continue` cannot be used outside of a `repeat` loop."),null!=n.loop)return n.resolveNext(t)}}})),t.addCommand("break",(function(e,t,r){if(r.matchToken("break"))return{op:function(n){for(var i=this.parent;;i=i.parent)if(null==i&&e.raiseParseError(r,"Command `continue` cannot be used outside of a `repeat` loop."),null!=i.loop)return t.findNext(i.parent,n)}}})),t.addGrammarElement("stringLike",(function(e,t,r){return e.parseAnyOf(["string","nakedString"],r)})),t.addCommand("append",(function(e,t,r){if(r.matchToken("append")){var n=null,i=e.requireElement("expression",r),o={type:"symbol",evaluate:function(e){return t.resolveSymbol("result",e)}};n=r.matchToken("to")?e.requireElement("expression",r):o;var a=null;"symbol"!==n.type&&"attributeRef"!==n.type&&null==n.root||(a=E(e,t,r,n,o));var s={value:i,target:n,args:[n,i],op:function(e,r,n){if(Array.isArray(r))return r.push(n),t.findNext(this,e);if(r instanceof Element)return r.innerHTML+=n,t.findNext(this,e);if(a)return e.result=(r||"")+n,a;throw Error("Unable to append a value!")},execute:function(e){return t.unifiedExec(this,e)}};return null!=a&&(a.parent=s),s}}));class y{constructor(e,t){this.re=e,this.str=t}next(){const e=this.re.exec(this.str);return null===e?{done:!0}:{value:e}}}class k{constructor(e,t,r){this.re=e,this.flags=t,this.str=r}[Symbol.iterator](){return new y(new RegExp(this.re,this.flags),this.str)}}function x(e,t){var r,n="text";return e.matchToken("a")||e.matchToken("an"),e.matchToken("json")||e.matchToken("Object")?n="json":e.matchToken("response")?n="response":e.matchToken("html")?n="html":e.matchToken("text")||(r=t.requireElement("dotOrColonPath",e).evaluate()),{type:n,conversion:r}}t.addCommand("pick",((e,t,r)=>{if(r.matchToken("pick")){if(r.matchToken("the"),r.matchToken("item")||r.matchToken("items")||r.matchToken("character")||r.matchToken("characters")){const n=function(e,t,r){r.matchToken("at")||r.matchToken("from");const n={includeStart:!0,includeEnd:!1};return n.from=r.matchToken("start")?0:e.requireElement("expression",r),(r.matchToken("to")||r.matchOpToken(".."))&&(r.matchToken("end")?n.toEnd=!0:n.to=e.requireElement("expression",r)),r.matchToken("inclusive")?n.includeEnd=!0:r.matchToken("exclusive")&&(n.includeStart=!1),n}(e,0,r);r.requireToken("from");return{args:[e.requireElement("expression",r),n.from,n.to],op(e,r,i,o){return n.toEnd&&(o=r.length),n.includeStart||i++,n.includeEnd&&o++,null!=o&&null!=o||(o=i+1),e.result=r.slice(i,o),t.findNext(this,e)}}}if(r.matchToken("match")){r.matchToken("of");const n=e.parseElement("expression",r);let i="";r.matchOpToken("|")&&(i=r.requireToken("identifier").value),r.requireToken("from");return{args:[e.parseElement("expression",r),n],op(e,r,n){return e.result=new RegExp(n,i).exec(r),t.findNext(this,e)}}}if(r.matchToken("matches")){r.matchToken("of");const n=e.parseElement("expression",r);let i="gu";r.matchOpToken("|")&&(i="g"+r.requireToken("identifier").value.replace("g","")),console.log("flags",i),r.requireToken("from");return{args:[e.parseElement("expression",r),n],op(e,r,n){return e.result=new k(n,i,r),t.findNext(this,e)}}}}})),t.addCommand("increment",(function(e,t,r){if(r.matchToken("increment")){var n,i=e.parseElement("assignableExpression",r);r.matchToken("by")&&(n=e.requireElement("expression",r));var o={type:"implicitIncrementOp",target:i,args:[i,n],op:function(e,t,r){var i=(t=t?parseFloat(t):0)+(r=n?parseFloat(r):1);return e.result=i,i},evaluate:function(e){return t.unifiedEval(this,e)}};return E(e,t,r,i,o)}})),t.addCommand("decrement",(function(e,t,r){if(r.matchToken("decrement")){var n,i=e.parseElement("assignableExpression",r);r.matchToken("by")&&(n=e.requireElement("expression",r));var o={type:"implicitDecrementOp",target:i,args:[i,n],op:function(e,t,r){var i=(t=t?parseFloat(t):0)-(r=n?parseFloat(r):1);return e.result=i,i},evaluate:function(e){return t.unifiedEval(this,e)}};return E(e,t,r,i,o)}})),t.addCommand("fetch",(function(e,t,r){if(r.matchToken("fetch")){var n,i=e.requireElement("stringLike",r);if(r.matchToken("as")&&(n=x(r,e)),r.matchToken("with")&&"{"!==r.currentToken().value)var o=e.parseElement("nakedNamedArgumentList",r);else o=e.parseElement("objectLiteral",r);null==n&&r.matchToken("as")&&(n=x(r,e));var a=n?n.type:"text",s=n?n.conversion:null,u={url:i,argExpressions:o,args:[i,o],op:function(e,r,n){var i=n||{};i.sender=e.me,i.headers=i.headers||{};var o=new AbortController;let l=e.me.addEventListener("fetch:abort",(function(){o.abort()}),{once:!0});i.signal=o.signal,t.triggerEvent(e.me,"hyperscript:beforeFetch",i),t.triggerEvent(e.me,"fetch:beforeRequest",i);var c=!1;return(n=i).timeout&&setTimeout((function(){c||o.abort()}),n.timeout),fetch(r,n).then((function(r){let n={response:r};return t.triggerEvent(e.me,"fetch:afterResponse",n),r=n.response,"response"===a?(e.result=r,t.triggerEvent(e.me,"fetch:afterRequest",{result:r}),c=!0,t.findNext(u,e)):"json"===a?r.json().then((function(r){return e.result=r,t.triggerEvent(e.me,"fetch:afterRequest",{result:r}),c=!0,t.findNext(u,e)})):r.text().then((function(r){return s&&(r=t.convertValue(r,s)),"html"===a&&(r=t.convertValue(r,"Fragment")),e.result=r,t.triggerEvent(e.me,"fetch:afterRequest",{result:r}),c=!0,t.findNext(u,e)}))})).catch((function(r){throw t.triggerEvent(e.me,"fetch:error",{reason:r}),r})).then((function(t){return e.me.removeEventListener("fetch:abort",l),t}),(function(t){throw e.me.removeEventListener("fetch:abort",l),t}))}};return u}}))}function T(e){e.addCommand("settle",(function(e,t,r){if(r.matchToken("settle")){if(e.commandBoundary(r.currentToken()))n=e.requireElement("implicitMeTarget",r);else var n=e.requireElement("expression",r);var i={type:"settleCmd",args:[n],op:function(e,r){t.nullCheck(r,n);var o=null,a=!1,s=new Promise((function(e){o=e}));return r.addEventListener("transitionstart",(function(){a=!0}),{once:!0}),setTimeout((function(){a||o(t.findNext(i,e))}),500),r.addEventListener("transitionend",(function(){o(t.findNext(i,e))}),{once:!0}),s},execute:function(e){return t.unifiedExec(this,e)}};return i}})),e.addCommand("add",(function(e,t,r){if(r.matchToken("add")){var n=e.parseElement("classRef",r),i=null,o=null,a=null;if(null==n)null==(i=e.parseElement("attributeRef",r))&&null==(o=e.parseElement("styleLiteral",r))&&e.raiseParseError(r,"Expected either a class reference or attribute expression");else for(a=[n];n=e.parseElement("classRef",r);)a.push(n);if(r.matchToken("to"))var s=e.requireElement("expression",r);else s=e.requireElement("implicitMeTarget",r);if(r.matchToken("when")){o&&e.raiseParseError(r,"Only class and properties are supported with a when clause");var u=e.requireElement("expression",r)}return a?{classRefs:a,to:s,args:[s,a],op:function(e,r,n){return t.nullCheck(r,s),t.forEach(n,(function(n){t.implicitLoop(r,(function(r){if(u){e.result=r,t.evaluateNoPromise(u,e)?r instanceof Element&&r.classList.add(n.className):r instanceof Element&&r.classList.remove(n.className),e.result=null}else r instanceof Element&&r.classList.add(n.className)}))})),t.findNext(this,e)}}:i?{type:"addCmd",attributeRef:i,to:s,args:[s],op:function(e,r,n){return t.nullCheck(r,s),t.implicitLoop(r,(function(r){if(u){e.result=r,t.evaluateNoPromise(u,e)?r.setAttribute(i.name,i.value):r.removeAttribute(i.name),e.result=null}else r.setAttribute(i.name,i.value)})),t.findNext(this,e)},execute:function(e){return t.unifiedExec(this,e)}}:{type:"addCmd",cssDeclaration:o,to:s,args:[s,o],op:function(e,r,n){return t.nullCheck(r,s),t.implicitLoop(r,(function(e){e.style.cssText+=n})),t.findNext(this,e)},execute:function(e){return t.unifiedExec(this,e)}}}})),e.addGrammarElement("styleLiteral",(function(e,t,r){if(r.matchOpToken("{")){for(var n=[""],i=[];r.hasMore();){if(r.matchOpToken("\\"))r.consumeToken();else{if(r.matchOpToken("}"))break;if(r.matchToken("$")){var o=r.matchOpToken("{"),a=e.parseElement("expression",r);o&&r.requireOpToken("}"),i.push(a),n.push("")}else{var s=r.consumeToken();n[n.length-1]+=r.source.substring(s.start||0,s.end)}}n[n.length-1]+=r.lastWhitespace()}return{type:"styleLiteral",args:[i],op:function(e,t){var r="";return n.forEach((function(e,n){r+=e,n in t&&(r+=t[n])})),r},evaluate:function(e){return t.unifiedEval(this,e)}}}})),e.addCommand("remove",(function(e,t,r){if(r.matchToken("remove")){var n,i=e.parseElement("classRef",r),o=null,a=null,s=null;if(null==i)null==(o=e.parseElement("attributeRef",r))&&null==(a=e.parseElement("expression",r))&&e.raiseParseError(r,"Expected either a class reference, attribute expression or value expression");else for(s=[i];i=e.parseElement("classRef",r);)s.push(i);return r.matchToken("from")?n=e.requireElement("expression",r):null==a&&(n=e.requireElement("implicitMeTarget",r)),a?{elementExpr:a,from:n,args:[a,n],op:function(e,r,n){return t.nullCheck(r,a),t.implicitLoop(r,(function(e){e.parentElement&&(null==n||n.contains(e))&&e.parentElement.removeChild(e)})),t.findNext(this,e)}}:{classRefs:s,attributeRef:o,elementExpr:a,from:n,args:[s,n],op:function(e,r,i){return t.nullCheck(i,n),r?t.forEach(r,(function(e){t.implicitLoop(i,(function(t){t.classList.remove(e.className)}))})):t.implicitLoop(i,(function(e){e.removeAttribute(o.name)})),t.findNext(this,e)}}}})),e.addCommand("toggle",(function(e,t,r){if(r.matchToken("toggle")){r.matchAnyToken("the","my");var n,o,a,s,u,l=!1,c=null;if("STYLE_REF"===r.currentToken().type){var m=r.consumeToken().value.substr(1);l=!0;var p=i(e,r,m);if(r.matchToken("of")){r.pushFollow("with");try{n=e.requireElement("expression",r)}finally{r.popFollow()}}else n=e.requireElement("implicitMeTarget",r)}else if(r.matchToken("between")){var f=!0,h=e.parseElement("classRef",r);r.requireToken("and"),o=e.requireElement("classRef",r)}else{h=e.parseElement("classRef",r);var d=null;if(null==h)null==(d=e.parseElement("attributeRef",r))&&e.raiseParseError(r,"Expected either a class reference or attribute expression");else for(c=[h];h=e.parseElement("classRef",r);)c.push(h)}!0!==l&&(n=r.matchToken("on")?e.requireElement("expression",r):e.requireElement("implicitMeTarget",r)),r.matchToken("for")?a=e.requireElement("expression",r):r.matchToken("until")&&(s=e.requireElement("dotOrColonPath",r,"Expected event name"),r.matchToken("from")&&(u=e.requireElement("expression",r)));var v={classRef:h,classRef2:o,classRefs:c,attributeRef:d,on:n,time:a,evt:s,from:u,toggle:function(e,r,i,o){t.nullCheck(e,n),l?t.implicitLoop(e,(function(e){p("toggle",e)})):f?t.implicitLoop(e,(function(e){e.classList.contains(r.className)?(e.classList.remove(r.className),e.classList.add(i.className)):(e.classList.add(r.className),e.classList.remove(i.className))})):o?t.forEach(o,(function(r){t.implicitLoop(e,(function(e){e.classList.toggle(r.className)}))})):t.forEach(e,(function(e){e.hasAttribute(d.name)?e.removeAttribute(d.name):e.setAttribute(d.name,d.value)}))},args:[n,a,s,u,h,o,c],op:function(e,r,n,i,o,a,s,u){return n?new Promise((function(i){v.toggle(r,a,s,u),setTimeout((function(){v.toggle(r,a,s,u),i(t.findNext(v,e))}),n)})):i?new Promise((function(n){(o||e.me).addEventListener(i,(function(){v.toggle(r,a,s,u),n(t.findNext(v,e))}),{once:!0}),v.toggle(r,a,s,u)})):(this.toggle(r,a,s,u),t.findNext(v,e))}};return v}}));var t={display:function(r,n,i){if(i)n.style.display=i;else if("toggle"===r)"none"===getComputedStyle(n).display?t.display("show",n,i):t.display("hide",n,i);else if("hide"===r){const t=e.runtime.getInternalData(n);null==t.originalDisplay&&(t.originalDisplay=n.style.display),n.style.display="none"}else{const t=e.runtime.getInternalData(n);t.originalDisplay&&"none"!==t.originalDisplay?n.style.display=t.originalDisplay:n.style.removeProperty("display")}},visibility:function(e,r,n){n?r.style.visibility=n:"toggle"===e?"hidden"===getComputedStyle(r).visibility?t.visibility("show",r,n):t.visibility("hide",r,n):r.style.visibility="hide"===e?"hidden":"visible"},opacity:function(e,r,n){n?r.style.opacity=n:"toggle"===e?"0"===getComputedStyle(r).opacity?t.opacity("show",r,n):t.opacity("hide",r,n):r.style.opacity="hide"===e?"0":"1"}},n=function(e,t,r){var n=r.currentToken();return"when"===n.value||"with"===n.value||e.commandBoundary(n)?e.parseElement("implicitMeTarget",r):e.parseElement("expression",r)},i=function(e,n,i){var o=r.defaultHideShowStrategy,a=t;r.hideShowStrategies&&(a=Object.assign(a,r.hideShowStrategies));var s=a[i=i||o||"display"];return null==s&&e.raiseParseError(n,"Unknown show/hide strategy : "+i),s};function o(t,r,n,i){var o;if((o=void 0!==n?t.resolveSymbol(n,r):r)instanceof Element||o instanceof Document){for(;o.firstChild;)o.removeChild(o.firstChild);o.append(e.runtime.convertValue(i,"Fragment")),t.processNode(o)}else{if(void 0===n)throw"Don't know how to put a value into "+typeof r;t.setSymbol(n,r,void 0,i)}}function a(e,t,r){var n;if(r.matchToken("the")||r.matchToken("element")||r.matchToken("elements")||"CLASS_REF"===r.currentToken().type||"ID_REF"===r.currentToken().type||r.currentToken().op&&"<"===r.currentToken().value){e.possessivesDisabled=!0;try{n=e.parseElement("expression",r)}finally{e.possessivesDisabled=!1}r.matchOpToken("'")&&r.requireToken("s")}else if("IDENTIFIER"===r.currentToken().type&&"its"===r.currentToken().value){var i=r.matchToken("its");n={type:"pseudopossessiveIts",token:i,name:i.value,evaluate:function(e){return t.resolveSymbol("it",e)}}}else r.matchToken("my")||r.matchToken("me"),n=e.parseElement("implicitMeTarget",r);return n}e.addCommand("hide",(function(e,t,r){if(r.matchToken("hide")){var o=n(e,0,r),a=null;r.matchToken("with")&&0===(a=r.requireTokenType("IDENTIFIER","STYLE_REF").value).indexOf("*")&&(a=a.substr(1));var s=i(e,r,a);return{target:o,args:[o],op:function(e,r){return t.nullCheck(r,o),t.implicitLoop(r,(function(e){s("hide",e)})),t.findNext(this,e)}}}})),e.addCommand("show",(function(e,t,r){if(r.matchToken("show")){var o=n(e,0,r),a=null;r.matchToken("with")&&0===(a=r.requireTokenType("IDENTIFIER","STYLE_REF").value).indexOf("*")&&(a=a.substr(1));var s,u=null;if(r.matchOpToken(":")){var l=r.consumeUntilWhitespace();r.matchTokenType("WHITESPACE"),u=l.map((function(e){return e.value})).join("")}r.matchToken("when")&&(s=e.requireElement("expression",r));var c=i(e,r,a);return{target:o,when:s,args:[o],op:function(e,r){return t.nullCheck(r,o),t.implicitLoop(r,(function(r){if(s){e.result=r,t.evaluateNoPromise(s,e)?c("show",r,u):c("hide",r),e.result=null}else c("show",r,u)})),t.findNext(this,e)}}}})),e.addCommand("take",(function(e,t,r){if(r.matchToken("take")){let s=null,u=[];for(;s=e.parseElement("classRef",r);)u.push(s);var n=null,i=null;let l=u.length>0;var o;if(l||(null==(n=e.parseElement("attributeRef",r))&&e.raiseParseError(r,"Expected either a class reference or attribute expression"),r.matchToken("with")&&(i=e.requireElement("expression",r))),r.matchToken("from")&&(o=e.requireElement("expression",r)),r.matchToken("for"))var a=e.requireElement("expression",r);else a=e.requireElement("implicitMeTarget",r);return l?{classRefs:u,from:o,forElt:a,args:[u,o,a],op:function(e,r,n,i){return t.nullCheck(i,a),t.implicitLoop(r,(function(e){var r=e.className;n?t.implicitLoop(n,(function(e){e.classList.remove(r)})):t.implicitLoop(e,(function(e){e.classList.remove(r)})),t.implicitLoop(i,(function(e){e.classList.add(r)}))})),t.findNext(this,e)}}:{attributeRef:n,from:o,forElt:a,args:[o,a,i],op:function(e,r,i,s){return t.nullCheck(r,o),t.nullCheck(i,a),t.implicitLoop(r,(function(e){s?e.setAttribute(n.name,s):e.removeAttribute(n.name)})),t.implicitLoop(i,(function(e){e.setAttribute(n.name,n.value||"")})),t.findNext(this,e)}}}})),e.addCommand("put",(function(e,t,r){if(r.matchToken("put")){var n=e.requireElement("expression",r),i=r.matchAnyToken("into","before","after");if(void 0===i&&r.matchToken("at")&&(r.matchToken("the"),i=r.matchAnyToken("start","end"),r.requireToken("of")),void 0===i)return e.raiseParseError(r,"Expected one of 'into', 'before', 'at start of', 'at end of', 'after'");var a=e.requireElement("expression",r),s=i.value,u=!1,l=!1,c=null,m=null;if("arrayIndex"===a.type&&"into"===s)u=!0,m=a.prop,c=a.root;else if(a.prop&&a.root&&"into"===s)m=a.prop.value,c=a.root;else if("symbol"===a.type&&"into"===s)l=!0,m=a.name;else if("attributeRef"===a.type&&"into"===s){var p=!0;m=a.name,c=e.requireElement("implicitMeTarget",r)}else if("styleRef"===a.type&&"into"===s){var f=!0;m=a.name,c=e.requireElement("implicitMeTarget",r)}else if(a.attribute&&"into"===s){p="attributeRef"===a.attribute.type,f="styleRef"===a.attribute.type;m=a.attribute.name,c=a.root}else c=a;var h={target:a,operation:s,symbolWrite:l,value:n,args:[c,m,n],op:function(e,r,n,i){if(l)o(t,e,n,i);else if(t.nullCheck(r,c),"into"===s)p?t.implicitLoop(r,(function(e){e.setAttribute(n,i)})):f?t.implicitLoop(r,(function(e){e.style[n]=i})):u?r[n]=i:t.implicitLoop(r,(function(e){o(t,e,n,i)}));else{var a="before"===s?Element.prototype.before:"after"===s?Element.prototype.after:"start"===s?Element.prototype.prepend:Element.prototype.append;t.implicitLoop(r,(function(e){a.call(e,i instanceof Node?i:t.convertValue(i,"Fragment")),e.parentElement?t.processNode(e.parentElement):t.processNode(e)}))}return t.findNext(this,e)}};return h}})),e.addCommand("transition",(function(e,t,n){if(n.matchToken("transition")){for(var i,o,s=a(e,t,n),u=[],l=[],c=[],m=n.currentToken();!e.commandBoundary(m)&&"over"!==m.value&&"using"!==m.value;){if("STYLE_REF"===n.currentToken().type){let e=n.consumeToken().value.substr(1);u.push({type:"styleRefValue",evaluate:function(){return e}})}else u.push(e.requireElement("stringLike",n));n.matchToken("from")?l.push(e.requireElement("expression",n)):l.push(null),n.requireToken("to"),n.matchToken("initial")?c.push({type:"initial_literal",evaluate:function(){return"initial"}}):c.push(e.requireElement("expression",n)),m=n.currentToken()}n.matchToken("over")?i=e.requireElement("expression",n):n.matchToken("using")&&(o=e.requireElement("expression",n));var p={to:c,args:[s,u,l,c,o,i],op:function(e,n,i,o,a,u,l){t.nullCheck(n,s);var c=[];return t.implicitLoop(n,(function(e){var n=new Promise((function(n,s){var c=e.style.transition;e.style.transition=l?"all "+l+"ms ease-in":u||r.defaultTransition;for(var m=t.getInternalData(e),p=getComputedStyle(e),f={},h=0;h<p.length;h++){var d=p[h],v=p[d];f[d]=v}m.initialStyles||(m.initialStyles=f);for(h=0;h<i.length;h++){var E=i[h],T=o[h];e.style[E]="computed"===T||null==T?f[E]:T}var y=!1,k=!1;e.addEventListener("transitionend",(function(){k||(e.style.transition=c,k=!0,n(void 0))}),{once:!0}),e.addEventListener("transitionstart",(function(){y=!0}),{once:!0}),setTimeout((function(){k||y||(e.style.transition=c,k=!0,n(void 0))}),100),setTimeout((function(){for(var t=0;t<i.length;t++){var r=i[t],n=a[t];if("initial"===n){var o=m.initialStyles[r];e.style[r]=o}else e.style[r]=n}}),0)}));c.push(n)})),Promise.all(c).then((function(){return t.findNext(p,e)}))}};return p}})),e.addCommand("measure",(function(e,t,r){if(r.matchToken("measure")){var n=a(e,t,r),i=[];if(!e.commandBoundary(r.currentToken()))do{i.push(r.matchTokenType("IDENTIFIER").value)}while(r.matchOpToken(","));return{properties:i,args:[n],op:function(e,r){t.nullCheck(r,n),0 in r&&(r=r[0]);var o=r.getBoundingClientRect(),a={top:r.scrollTop,left:r.scrollLeft,topMax:r.scrollTopMax,leftMax:r.scrollLeftMax,height:r.scrollHeight,width:r.scrollWidth};return e.result={x:o.x,y:o.y,left:o.left,top:o.top,right:o.right,bottom:o.bottom,width:o.width,height:o.height,bounds:o,scrollLeft:a.left,scrollTop:a.top,scrollLeftMax:a.leftMax,scrollTopMax:a.topMax,scrollWidth:a.width,scrollHeight:a.height,scroll:a},t.forEach(i,(function(t){if(!(t in e.result))throw"No such measurement as "+t;e.locals[t]=e.result[t]})),t.findNext(this,e)}}}})),e.addLeafExpression("closestExpr",(function(e,t,r){if(r.matchToken("closest")){var n,i,o,a,s;r.matchToken("parent")&&(n=!0),"ATTRIBUTE_REF"===r.currentToken().type&&(i=e.requireElement("attributeRefAccess",r,void 0),o="["+i.attribute.name+"]"),null==o&&(null==(a=e.requireElement("expression",r)).css?e.raiseParseError(r,"Expected a CSS expression"):o=a.css),s=r.matchToken("to")?e.parseElement("expression",r):e.parseElement("implicitMeTarget",r);var u={type:"closestExpr",parentSearch:n,expr:a,css:o,to:s,args:[s],op:function(e,r){if(null==r)return null;{let e=[];return t.implicitLoop(r,(function(t){n?e.push(t.parentElement?t.parentElement.closest(o):null):e.push(t.closest(o))})),t.shouldAutoIterate(r)?e:e[0]}},evaluate:function(e){return t.unifiedEval(this,e)}};return i?(i.root=u,i.args=[u],i):u}})),e.addCommand("go",(function(e,t,r){if(r.matchToken("go")){var n,i;if(r.matchToken("back"))var o=!0;else if(r.matchToken("to"),r.matchToken("url")){n=e.requireElement("stringLike",r);var a=!0;if(r.matchToken("in")){r.requireToken("new"),r.requireToken("window");var s=!0}}else{r.matchToken("the");var u=r.matchAnyToken("top","middle","bottom"),l=r.matchAnyToken("left","center","right");(u||l)&&r.requireToken("of"),n=e.requireElement("unaryExpression",r);var c=r.matchAnyOpToken("+","-");if(c){r.pushFollow("px");try{i=e.requireElement("expression",r)}finally{r.popFollow()}}r.matchToken("px");var m=r.matchAnyToken("smoothly","instantly"),p={block:"start",inline:"nearest"};u&&("top"===u.value?p.block="start":"bottom"===u.value?p.block="end":"middle"===u.value&&(p.block="center")),l&&("left"===l.value?p.inline="start":"center"===l.value?p.inline="center":"right"===l.value&&(p.inline="end")),m&&("smoothly"===m.value?p.behavior="smooth":"instantly"===m.value&&(p.behavior="instant"))}var f={target:n,args:[n,i],op:function(e,r,n){return o?window.history.back():a?r&&(s?window.open(r):window.location.href=r):t.implicitLoop(r,(function(e){if(e===window&&(e=document.body),c){let t=e.getBoundingClientRect(),r=document.createElement("div"),i="+"===c.value?n:-1*n,o="start"==p.inline||"end"==p.inline?i:0,a="start"==p.block||"end"==p.block?i:0;r.style.position="absolute",r.style.top=t.top+window.scrollY+a+"px",r.style.left=t.left+window.scrollX+o+"px",r.style.height=t.height+"px",r.style.width=t.width+"px",r.style.zIndex=""+Number.MIN_SAFE_INTEGER,r.style.opacity="0",document.body.appendChild(r),setTimeout((function(){document.body.removeChild(r)}),100),e=r}e.scrollIntoView(p)})),t.findNext(f,e)}};return f}})),r.conversions.dynamicResolvers.push((function(t,r){if("Values"===t||0===t.indexOf("Values:")){var n=t.split(":")[1],i={};if(e.runtime.implicitLoop.bind(e.runtime)(r,(function(e){var t=a(e);void 0===t||void 0===t.value?null!=e.querySelectorAll&&e.querySelectorAll("input,select,textarea").forEach(o):i[t.name]=t.value})),n){if("JSON"===n)return JSON.stringify(i);if("Form"===n)return new URLSearchParams(i).toString();throw"Unknown conversion: "+n}return i}function o(e){var t=a(e);void 0!==t&&void 0!==t.value&&(void 0!==i[t.name]||(i[t.name]=t.value))}function a(e){try{var t={name:e.name,value:e.value};if(void 0===t.name||void 0===t.value)return;if("radio"===e.type&&!1===e.checked)return;if("checkbox"==e.type&&(!1===e.checked?t.value=void 0:"string"==typeof t.value&&(t.value=[t.value])),"select-multiple"==e.type){var r=e.querySelectorAll("option[selected]");t.value=[];for(var n=0;n<r.length;n++)t.value.push(r[n].value)}return t}catch(e){return}}})),r.conversions.HTML=function(e){var t=function(e){if(e instanceof Array)return e.map((function(e){return t(e)})).join("");if(e instanceof Element)return e.outerHTML;if(e instanceof NodeList){for(var r="",n=0;n<e.length;n++){var i=e[n];i instanceof Element&&(r+=i.outerHTML)}return r}return e.toString?e.toString():""};return t(e)},r.conversions.Fragment=function(t){var r=document.createDocumentFragment();return e.runtime.implicitLoop(t,(function(e){if(e instanceof Node)r.append(e);else{var t=document.createElement("template");t.innerHTML=e,r.append(t.content)}})),r}}const y=new a,k=y.lexer,x=y.parser;const g={config:r,use(e){e(b)},internals:{Lexer:n,lexer:k,Parser:o,parser:x,Runtime:a,runtime:y,Tokens:i},ElementCollection:p,addFeature:x.addFeature.bind(x),addCommand:x.addCommand.bind(x),addLeafExpression:x.addLeafExpression.bind(x),addIndirectExpression:x.addIndirectExpression.bind(x),evaluate:y.evaluate.bind(y),parse:y.parse.bind(y),processNode:y.processNode.bind(y),version:"0.9.12",browserInit:function(){var t=Array.from(e.document.querySelectorAll("script[type='text/hyperscript'][src]"));Promise.all(t.map((function(e){return fetch(e.src).then((function(e){return e.text()}))}))).then((e=>e.forEach((e=>b(e))))).then((()=>{return t=function(){var t,n;n=document.querySelector('meta[name="htmx-config"]'),(t=null!==n?d(n.content):null)&&Object.assign(r,t),y.processNode(document.documentElement),e.document.addEventListener("htmx:load",(function(e){y.processNode(e.detail.elt)}))},void("loading"!==document.readyState?setTimeout(t):document.addEventListener("DOMContentLoaded",t));var t}))}},b=Object.assign(g.evaluate,g);return b}));
